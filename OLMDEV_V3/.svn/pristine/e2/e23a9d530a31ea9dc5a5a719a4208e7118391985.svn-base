<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--	project Item 관련 관련	-->
<mapper namespace="project_SQL">
 
 <!-- 2012-XBOLT_SSK Start -->
 	 <!-- 프로젝트 : 변경이력관리 조회 -->
  	
 	<delete id="delTaskINfo">
 		Delete
 			XBOLTADM.TB_TASK
 		WHERE
 			ChangeSetID = #{ChangeSetID}	
 	</delete>
 	  
 	
 	<insert id="createProject" parameterType="java.util.HashMap">
 		INSERT INTO
 			XBOLTADM.TB_PROJECT(
 				ProjectType
 				, ProjectID
 				, CreationTime
 				, LastUpdated
 				, Status
 				, Creator
 				, OwnerTeamID
 				, ParentID
 				, AuthorID
 				, WFID
      			, CurWFStepID
      			, Seq
 				, PJCategory
 				, ProjectCode
 				, AprvOption 
 				, TemplCode
 				, Prefix
 				, RefPGID
 				, ItemAccCtrl
				<if test="RefPjtID != null and RefPjtID != ''">
 					, RefPjtID
				</if>
 				, CompanyID
				<if test="StartDate != null and StartDate != ''">
					, StartDate
				</if>
				<if test="DueDate != null and DueDate != ''">
					, DueDate
				</if>
				<if test="AuthorName != null and AuthorName != ''">
					, AuthorName
				</if>
				<if test="Priority != null and Priority != ''">
					, Priority
				</if>
				<if test="Reason != null and Reason != ''">
					, Reason
				</if>
				<if test="srID != null and srID != ''">
					, SRID
				</if>
				<if test="checkInOption != null and checkInOption != ''">
					, CheckInOption
				</if>
				<if test="closingOption != null and closingOption != ''">
					, ClosingOption
				</if>
 		)VALUES(
 			 #{ProjectType}
 			,#{ProjectID}
 			,getDate()
 			,getDate()			
 			,#{Status}
 			,#{UserID}
 			,#{TeamID}
 			,#{ParentID}
 			,#{AuthorID}
 			,#{WFID}
      		,#{CurWFStepID}
      		,#{Seq}
 			,#{PJCategory}
 			,#{ProjectCode}
 			,#{AprvOption}
 			,#{TemplCode}
 			,#{Prefix}
 			,#{RefPGID}
 			,#{itemAccCtrl}
			<if test="RefPjtID != null and RefPjtID != ''">
				, #{RefPjtID}
			</if>
 			,#{CompanyID}
			<if test="StartDate != null and StartDate != ''">
				, #{StartDate}
			</if>
			<if test="DueDate != null and DueDate != ''">
				, #{DueDate}
			</if>
			<if test="AuthorName != null and AuthorName != ''">
				, N''+#{AuthorName}
			</if>
			<if test="Priority != null and Priority != ''">
				, #{Priority}
			</if>
			<if test="Reason != null and Reason != ''">
				, #{Reason}
			</if>
			<if test="srID != null and srID != ''">
				, #{srID}
			</if>
			<if test="checkInOption != null and checkInOption != ''">
				, #{checkInOption}
			</if>
			<if test="closingOption != null and closingOption != ''">
				, #{closingOption}
			</if>
 		)	
 	</insert>
 
 	<insert id="createProjectTxt" parameterType="java.util.HashMap">
 		INSERT INTO
 			XBOLTADM.TB_PROJECT_TXT(ProjectID, Name, Description, LanguageID)
		VALUES(
			#{ProjectID}
			,#{Name}
			,#{Description}
			,#{languageID}
		)
 	</insert>
 	
 	<insert id="createPjtMemberRel" parameterType="java.util.HashMap">
 		INSERT INTO
 			XBOLTADM.TB_PJT_MEMBER_REL(ProjectID, MemberID, Authority, AssignedDate, MbrTeamID)
		VALUES(
			#{ProjectID}
			,#{MemberID}
			,(SELECT Authority FROM XBOLTADM.TB_MEMBER WHERE MemberID = #{MemberID})
			,getDate()
			,(SELECT TeamID FROM XBOLTADM.TB_MEMBER WHERE MemberID = #{MemberID})
		)
 	</insert>
 	
 	<delete id="delPjtMemberRel" parameterType="java.util.HashMap">
 		DELETE 
 		FROM
 			XBOLTADM.TB_PJT_MEMBER_REL
		WHERE
			ProjectID = #{ProjectID}
			<if test="MemberID != null and MemberID != ''">
			AND MemberID = #{MemberID}
			</if>
			<if test="teamID != null and teamID != ''">
			AND MemberID IN (Select MemberID From XBOLTADM.TB_MEMBER Where TeamID = #{teamID} )
			</if>
 	</delete>

 	<update id="updateProject" parameterType="java.util.HashMap">
 		UPDATE	XBOLTADM.TB_PROJECT
 		SET
 			LastUpdated = getDate()
			<if test="Status != null and Status != ''">
			,Status = #{Status}
			</if>
			<if test="TeamID != null and TeamID != ''">
			,OwnerTeamID = #{TeamID}
			</if>
			<if test="AuthorID != null and AuthorID != ''">
			,AuthorID = #{AuthorID}
			</if>
			<if test="CompanyID != null and CompanyID != ''">
			,CompanyID = #{CompanyID}
			</if>
			<if test="AuthorName != null and AuthorName != ''">
			,AuthorName = #{AuthorName}
			</if>
			<if test="StartDate != null and StartDate != ''">
			,StartDate = #{StartDate}
			</if>
			<if test="DueDate != null and DueDate != ''">
			,DueDate = #{DueDate}
			</if>
			<if test="EndDate != null and EndDate != ''">
			,EndDate = getDate()
			</if>
			<if test="ProjectCode != null and ProjectCode != ''">
			,ProjectCode = #{ProjectCode}
			</if>
			<if test="AprvOption != null and AprvOption != ''">
			,AprvOption = #{AprvOption}
			</if>
			<if test="PJCategory != null and PJCategory != ''">
			,PJCategory = #{PJCategory}
			</if>
			<if test="WFID != null and WFID != ''">
			, WFID = #{WFID}
			</if>
			<if test="Seq != null and Seq != ''">
			, Seq = #{Seq}
			</if>
			<if test="TemplCode != null and TemplCode != ''">
			, TemplCode = #{TemplCode}
			</if>
			<if test="Prefix != null and Prefix != ''">
			, Prefix = #{Prefix}
			</if>
			<if test="Priority != null and Priority != ''">
			, Priority = #{Priority}
			</if>
			<if test="Reason != null and Reason != ''">
			, Reason = #{Reason}
			</if>
			<if test="ParentID != null and ParentID != ''">
			, ParentID = #{ParentID}
			</if>
			<if test="RefPGID != null and RefPGID != ''">
			, RefPGID = #{RefPGID}
			</if>
			<if test="RefPGID != null and RefPGID != ''">
			, RefPjtID = #{RefPjtID}
			</if>
			<if test="CurWFInstanceID != null and CurWFInstanceID != ''">
			, CurWFInstanceID = #{CurWFInstanceID}
			</if>
			<if test="procInstNo != null and procInstNo != ''">
			, ProcInstNo = #{procInstNo}
			</if>
			<if test="itemAccCtrl != null and itemAccCtrl != ''">
			, ItemAccCtrl = #{itemAccCtrl}
			</if>
 		<where>
 			<choose>
    		<when test="csrIDs != null and !csrIDs.equals('')">
				AND ProjectID IN (${csrIDs})
			</when>
			<otherwise>
				AND ProjectID = #{ProjectID}
			 </otherwise>
			 </choose>
		</where>
 	</update>
 	
 	<update id="updateProjectTxt" parameterType="java.util.HashMap">
 		UPDATE 
 			XBOLTADM.TB_PROJECT_TXT
		SET
			Name = #{Name}
			,Description = #{Description}
		WHERE
			ProjectID = #{ProjectID}
			AND LanguageID = #{languageID}

 	</update>


	<select id="getProjectInfo" resultType="java.util.HashMap">
		SELECT Distinct
			TP.ProjectID
			, TP.ProjectCode
			, TPT.Name AS ProjectName
			, TMT.Name AS TeamName
			, ISNULL(TM.Name,'')  AS AuthorName	
			, TP.SRID
			
			, TP.OwnerTeamID
			, TP.AuthorID
			, ISNULL(CONVERT(char(10),TP.CreationTime, 120),'') as CreationDate
			, ISNULL(CONVERT(char(10),TP.StartDate, 120),'') as StartDate
			, ISNULL(CONVERT(char(10),TP.DueDate, 120),'') as DueDate			
			, ISNULL(CONVERT(char(10),TP.EndDate, 120),'') as EndDate
			
			, TP.Status
			, ISNULL(TPT.Description, '') AS Description
			, XBOLTADM.fn_getMyAbsPathForProject(TP.ProjectID, #{languageID}) AS Path
			, TP.Creator
			, ISNULL(TP.WFID, '') As WFID
			, TM.EmployeeNum
			
			, TP.Priority
			, PRT.Name AS PriorityName
			
			<!-- , ISNULL(CONVERT(char(10),SRM.ReqDueDate, 120),'') as ReqDueDate
			, TM1.Name As  ReqUserNM
			, TMT1.Name As ReqTeamNM	
			
			, ATR1.PlainText AS  SRArea1Name
			, ATR2.PlainText AS  SRArea2Name			
			, TD1.Name AS SubCategoryNM	
			
			, SRM.Description As SRDescription -->
			, DOCCAT.Name As WFDocType
			, TP.CurWFInstanceID As WFInstanceID
			, TP.AprvOption
		FROM 
			XBOLTADM.TB_PROJECT TP
			Left Outer Join XBOLTADM.TB_TEAM_TXT TMT
				on TP.OwnerTeamID = TMT.TeamID AND TMT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT
				on TP.ProjectID = TPT.ProjectID AND TPT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_MEMBER TM
				on TP.AuthorID = TM.MemberID
			Left Outer Join XBOLTADM.TB_CHANGE_SET TCS
				on TP.ProjectID = TCS.ProjectID	
			LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY PRT 
				ON TP.Priority = PRT.TypeCode AND PRT.Category = 'PRT'
				AND PRT.LanguageID = #{languageID}
			<!-- LEFT OUTER JOIN XBOLTADM.TB_SR_MST SRM 
				ON SRM.SRID = TP.SRID
			LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY TD1
				ON TD1.TypeCode = SRM.SubCategory  AND TD1.Category = 'SRCAT' 	AND TD1.LanguageID = #{languageID}
			LEFT OUTER JOIN XBOLTADM.TB_ITEM_ATTR ATR1 
				ON SRM.SRArea1 = ATR1.ItemID and ATR1.AttrTypeCode = 'AT00001' AND ATR1.LanguageID = #{languageID} 
			LEFT OUTER JOIN XBOLTADM.TB_ITEM_ATTR ATR2
				ON SRM.SRArea2 = ATR2.ItemID and ATR2.AttrTypeCode = 'AT00001' AND ATR2.LanguageID = #{languageID} 	
			LEFT OUTER  JOIN XBOLTADM.TB_MEMBER TM1
				ON SRM.RequestUserID = TM1.MemberID	
			LEFT OUTER  JOIN  XBOLTADM.TB_TEAM_TXT TMT1
			    ON SRM.RequestTeamID = TMT1.TeamID AND TMT1.LanguageID = #{languageID}  -->
			Left Outer Join XBOLTADM.TB_DICTIONARY DOCCAT ON DOCCAT.TypeCode = TP.ProjectType AND DOCCAT.Category = 'DOCCAT' AND DOCCAT.LanguageID = #{languageID}  
		WHERE 
			TP.ProjectID = #{s_itemID}
	</select>
	
	<select id="getProjectInfoForCsr" resultType="java.util.HashMap">
		SELECT 
			TP.ProjectID
			, TP.ProjectCode
			, TP.ParentID
			, TPT.Name AS ProjectName
			, TPT2.Name AS ParentName
			, TMT.Name AS TeamName
			, ISNULL(TM.Name,'')  AS CreatorName	
			, TP.SRIS
			, TP.RefPGID
			, TP.RefPjtID
			
			, TP.OwnerTeamID
			, TP.AuthorID
			, ISNULL(CONVERT(char(10),TP.CreationTime, 120),'') as CreationDate
			, ISNULL(CONVERT(char(10),TP.StartDate, 120),'') as StartDate
			, ISNULL(CONVERT(char(10),TP.DueDate, 120),'') as DueDate			
			, ISNULL(CONVERT(char(10),TP.EndDate, 120),'') as EndDate
			
			, TP.Status
			, STS.Name As StatusName
			, ISNULL(TPT.Description, '') AS Description
			, XBOLTADM.fn_getMyAbsPathForProject(TP.ProjectID, #{languageID}) AS Path
			, TP.TemplCode
			
			, TP.WFID
			, WF.Name As WFName
			, TP.CurWFStepID
			, WFSTEP.Name AS CurWFStepName
			, XBOLTADM.fn_GetPjtMemberInfoList(TP.ProjectID, #{languageID}, 1) AS PjtMemberInfos
		FROM 
			XBOLTADM.TB_PROJECT TP
			
			Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT
				on TP.ProjectID = TPT.ProjectID AND TPT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT2
				on TP.RefPjtID = TPT2.ProjectID AND TPT2.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_MEMBER TM
				on TP.Creator = TM.MemberID
			Left Outer Join XBOLTADM.TB_TEAM_TXT TMT
				on TM.TeamID = TMT.TeamID AND TMT.LanguageID = #{languageID}
			
			LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY WFSTEP 
				ON WFSTEP.LanguageID = #{languageID} AND TP.CurWFStepID = WFSTEP.TypeCode
				AND WFSTEP.Category = 'WFSTEP'
				
			LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY WF 
				ON WF.LanguageID = #{languageID} AND TP.WFID = WF.TypeCode
				AND WF.Category = 'WF'
			
			LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY STS 
				ON STS.LanguageID = #{languageID} AND TP.Status = STS.TypeCode
				AND STS.Category = 'PJTSTS'
		WHERE 
			TP.ProjectID = #{s_itemID}
	</select>
	
	<select id="getProjectInfoView" resultType="java.util.HashMap">
		SELECT 
			TP.ProjectID
			, TP.ProjectCode
			, TPT.Name AS ProjectName
			, TMT.Name AS TeamName
			, TP.CompanyID
			, TCT.Name AS CompanyName
			, ISNULL(TM.Name,'')  AS AuthorName				
			, TP.OwnerTeamID
			, TP.AuthorID
			, ISNULL(CONVERT(char(10),TP.CreationTime, 120),'') as CreationDate
			, ISNULL(CONVERT(char(10),TP.StartDate, 120),'') as StartDate
			, ISNULL(CONVERT(char(10),TP.DueDate, 120),'') as DueDate			
			, ISNULL(CONVERT(char(10),TP.EndDate, 120),'') as EndDate			
			, TP.Status
			, ISNULL(TPT.Description, '') AS Description
			, XBOLTADM.fn_getMyAbsPathForProject(TP.ProjectID, #{languageID}) AS Path
			, rtrim(TP.ProjectType) AS ProjectType
			, rtrim(TP.PJCategory) AS PJCategory			
			, TP.TemplCode
			, TP.Prefix
			, TP.Creator
			, TD.Name AS StatusName
			, TP.RefPGID
			, TP2.ProjectCode AS RefPGCode
			, TP.RefPjtID
			, TP.SRID
			, TP.AprvOption
			, TD2.Name As AprvOptionName
		FROM 
			XBOLTADM.TB_PROJECT TP
			Left Outer Join XBOLTADM.TB_TEAM_TXT TMT on TP.OwnerTeamID = TMT.TeamID AND TMT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_TEAM_TXT TCT on TP.CompanyID = TCT.TeamID AND TCT.LanguageID = #{languageID}				
			Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT on TP.ProjectID = TPT.ProjectID AND TPT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_MEMBER TM on TP.AuthorID = TM.MemberID
			Left Outer Join XBOLTADM.TB_DICTIONARY TD on TP.Status = TD.TypeCode AND TD.LanguageID = #{languageID} AND TD.Category = 'PJTSTS'	
			Left Outer Join XBOLTADM.TB_DICTIONARY TD2 on TP.AprvOption = TD2.TypeCode AND TD2.LanguageID = #{languageID} AND TD2.Category = 'APRVOPTION'	
			Left Outer Join XBOLTADM.TB_PROJECT TP2 on TP.RefPGID = TP2.ProjectID	
		WHERE 
			TP.ProjectID = #{s_itemID}
	</select>
	
	<!-- 변경관리 - 프로젝트 리스트 -->
	<select id="getProjectList_gridList" resultType="java.util.HashMap">
		SELECT /*project_SQL.getProjectList_gridList*/
			 Row_Number()OVER(ORDER BY  TP.CreationTime DESC ) as RNUM 
			, TP.ProjectID
			, TP.ProjectType
			, TPPT.Name AS ParentName
			, TTPT.Name AS ParentTeamName
			, TP.OwnerTeamID			
			, TPT.Name AS ProjectName
			, COUNT(Distinct TCSN.ChangeSetID) AS NCount
			, COUNT(Distinct TCSM.ChangeSetID) AS MCount
			, COUNT(Distinct TCSD.ChangeSetID) AS DCount
			, COUNT(Distinct TCSR.ChangeSetID) AS RCount
			, COUNT(Distinct TCSS.ChangeSetID) AS SCount
			, ISNULL(CONVERT(char(10),TP.CreationTime, 111),'') as CreationTime
			, ISNULL(CONVERT(char(10),TP.EndDate, 111),'') as EndTime
			, TMT.Name AS TeamName
			, ISNULL(TM.Name,'') AS UserName
			, TD.Name AS StatusName
			, TP.CompanyID
			, TP.OwnerTeamID
			, TP.AuthorID
		FROM 
			XBOLTADM.TB_PROJECT TP
			Left Outer Join XBOLTADM.TB_TEAM TT
				on TT.TeamID = TP.OwnerTeamID
			LEFT Outer Join XBOLTADM.TB_TEAM_TXT TTPT
				on TTPT.TeamID = TT.ParentID	AND TTPT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_TEAM_TXT TMT
				on TP.OwnerTeamID = TMT.TeamID AND TMT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT
				on TP.ProjectID = TPT.ProjectID AND TPT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_MEMBER TM
				on TP.AuthorID = TM.MemberID
			Left Outer Join XBOLTADM.TB_CHANGE_SET TCSN
				on TP.ProjectID = TCSN.ProjectID AND TCSN.ChangeType = 'NEW'
			Left Outer Join XBOLTADM.TB_CHANGE_SET TCSM
				on TP.ProjectID = TCSM.ProjectID AND TCSM.ChangeType = 'MOD'
			Left Outer Join XBOLTADM.TB_CHANGE_SET TCSD
				on TP.ProjectID = TCSD.ProjectID AND TCSD.ChangeType = 'DEL'
			Left Outer Join XBOLTADM.TB_CHANGE_SET TCSR
				on TP.ProjectID = TCSR.ProjectID AND TCSR.ChangeType = 'OWC'
			Left Outer Join XBOLTADM.TB_CHANGE_SET TCSS
				on TP.ProjectID = TCSS.ProjectID AND TCSS.ChangeType = 'OTC'
			Left Outer Join XBOLTADM.TB_DICTIONARY TD
				on TP.Status = TD.TypeCode AND TD.LanguageID = 	#{languageID}
				AND TD.Category = 'PJTSTS'
			Left Outer Join XBOLTADM.TB_PROJECT_TXT TPPT
				on TP.RefPjtID = TPPT.ProjectID AND TPPT.LanguageID = #{languageID}
		WHERE 
		<!-- 
			TP.ParentID = #{s_itemID}
		 -->
			TP.PJCategory = #{category}
			AND TP.ProjectType = 3
			<if test="parentID != null and parentID != '' and !parentID.equals('null')">
			AND TT.ParentID = #{parentID}
			</if>
			<if test="Status != null and Status != '' and !Status.equals('null')">
			AND TP.Status = #{Status}
			</if>
			<if test="AuthorTeamID != null and AuthorTeamID != '' and !AuthorTeamID.equals('null')">
			AND TP.OwnerTeamID = #{AuthorTeamID}
			</if>
			<if test="SC_STR_DT != null and SC_STR_DT != '' and SC_END_DT != null and SC_END_DT != ''">
				CONVERT(VARCHAR,TP.CreationTime, 120) BETWEEN #{SC_STR_DT} AND #{SC_END_DT}
			</if>  	
		Group By
			TP.ProjectID
			, TP.ProjectType
			, TPPT.Name
			, TTPT.Name 			
			, TPT.Name 
			, TP.CreationTime
			, TP.EndDate
			, TMT.Name
			, TM.Name
			, TD.Name
			, TP.AuthorName	
			, TP.CompanyID
			, TP.OwnerTeamID
			, TP.AuthorID
	</select>

	<!-- 프로젝트 ChangeSet 리스트 -->
	<select id="getSetProjectList_gridList" resultType="java.util.HashMap">
		SELECT 
			 Row_Number()OVER(ORDER BY  TP.CreationTime DESC ) as RNUM 
			, 0 AS CHK 
			, TP.ProjectID
			, TP.CompanyID
			, TP.OwnerTeamID
			, XBOLTADM.fn_GetMyAbsPathForProject(TP.ProjectID, #{languageID}) AS Name
			, TP.ProjectCode
			, TPT.Name AS ProjectName
			, TG.ProjectCode + ' ' + TGT.Name AS ProjectGRName
			, TCT.Name AS CompanyName
			, TMT.Name AS TeamName
			, TPT.Description
			, ISNULL(TM.Name,'') AS CreatorName
			, ISNULL(CONVERT(char(10),TP.CreationTime, 111),'') as CreationTime
			, ISNULL(CONVERT(char(10),TP.StartDate, 111),'') as StartDate
			, ISNULL(CONVERT(char(10),TP.DueDate, 111),'') as DueDate
			, TD.Name AS StatusName
			, TP.ProjectType
			, (SELECT COUNT(PROJECTID) FROM XBOLTADM.TB_PROJECT WHERE RefPjtID = TP.ProjectID AND ProjectType != TP.ProjectType) As ChildCount
		FROM 
			XBOLTADM.TB_PROJECT TP
			Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT
				on TP.ProjectID = TPT.ProjectID AND TPT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_PROJECT TG 
			    ON TP.RefPGID = TG.ProjectID
			Left Outer Join XBOLTADM.TB_PROJECT_TXT TGT
				on TG.ProjectID = TGT.ProjectID AND TGT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_TEAM_TXT TCT
				on TP.CompanyID = TCT.TeamID AND TCT.LanguageID = #{languageID}	
			Left Outer Join XBOLTADM.TB_TEAM_TXT TMT
				on TP.OwnerTeamID = TMT.TeamID AND TMT.LanguageID = #{languageID}					
			Left Outer Join XBOLTADM.TB_MEMBER TM
				on TP.AuthorID = TM.MemberID
			Left Outer Join XBOLTADM.TB_DICTIONARY TD
				on TP.Status = TD.TypeCode AND TD.LanguageID = 	#{languageID}
				AND TD.Category = 'PJTSTS'
		<where>
			<if test="filter != null and filter != ''">
			TP.ProjectType = #{filter}
			</if>
			<if test="ParentID != null and ParentID != ''">
			AND TP.RefPjtID = #{ParentID}
			</if>
			<if test="refID != null and refID != '' and screenType.equals('PG')">
			AND TP.RefPGID = #{refID}
			</if>
			<if test="ProjectGroup != null and ProjectGroup != ''">
			AND TP.RefPGID = #{ProjectGroup}
			</if>
			<if test="Category != null and Category != ''">
			AND TP.PJCategory = #{Category}
			</if>
			<if test="Status != null and Status != ''">
			AND TP.Status = #{Status}
			</if>
			<if test="authorID != null and authorID != ''">
			AND TP.AuthorID = #{authorID}
			</if>
			<if test="CompanyID != null and CompanyID != ''">
			AND TP.CompanyID = #{CompanyID}
			</if>
			<if test="loginUserId != null and loginUserId != ''">
			AND #{loginUserId} IN (SELECT MemberID FROM XBOLTADM.TB_PJT_MEMBER_REL WHERE ProjectID = TP.ProjectID)
			</if>
			<if test="memberId != null and memberId != ''">
			AND (TP.AuthorID = #{memberId} OR #{memberId} IN (SELECT MemberID FROM XBOLTADM.TB_PJT_MEMBER_REL WHERE ProjectID = TP.ProjectID))
			</if>
		</where>
	ORDER BY
		TP.ProjectID DESC
	</select>
	
	<select id="getSetProjectListForCsr_gridList" resultType="java.util.HashMap">
		SELECT 
			TOP 1000
			 Row_Number()OVER(ORDER BY  TP.CreationTime DESC ) as RNUM 
			, 0 AS CHK 
			, TP.ProjectID
			, TP.SRID
			, TP.RefPjtID As ParentID
			, XBOLTADM.fn_GetMyAbsPathForProject(TP.ProjectID, #{languageID}) AS PjtPath
			, TP.ProjectCode
			, TPT.Name AS ProjectName
			, TPT2.Name As ParentName
			, TPT.Description
			, ISNULL(TM.Name,'') + Case When ISNULL(TM.NameEN,'') != '' Then '(' + ISNULL(TM.NameEN,'') + ')' Else '' End  AS CreatorName
			, ISNULL(TM2.Name,'')+ Case When ISNULL(TM2.NameEN,'') != '' Then '(' + ISNULL(TM2.NameEN,'') + ')' Else '' End  AS AuthorName
			, ISNULL(CONVERT(char(10),TP.CreationTime, 21),'') as CreationTime
			, TD.Name AS StatusName
			, TP.ProjectType
			, TP.WFID
			, WF.Name As WFName
			, TP.CurWFStepID
			, WFSTEP.Name AS CurWFStepName
			, TP.Seq
			, ISNULL(TP.AuthorID,'') AS AuthorID
			, TP.Creator
			, TTT.Name AS CreatorTeamName			
			, ISNULL(CONVERT(char(10),TP.StartDate, 21),'') as StartDate
			, ISNULL(CONVERT(char(10),TP.DueDate, 21),'') as DueDate
			, ISNULL(CONVERT(char(10),TP.EndDate, 21),'') as EndDate
			, TP.Status
			, TP.Priority
			, PRT.Name AS PriorityName
			, TP.Reason , TD2.Name As ReasonNM
			, (SELECT COUNT(ChangeSetID) FROM XBOLTADM.TB_CHANGE_SET WHERE ProjectID = TP.ProjectID) AS CNGT_CNT
			, TTT2.Name As AuthorTeamName
			, XBOLTADM.fn_GetChangeStatus(TP.ProjectID) AS ChangeStatus
			, TP.AprvOption
			, TD1.Name as AprvOptionNM
			, TP.Deactivated As Deactivated
			, TP.ClosingOption
			, ISNULL(TP.CurWFInstanceID,'') AS CurWFInstanceID
			, TP.ItemAccCtrl
		FROM 
			XBOLTADM.TB_PROJECT TP
			Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT
				on TP.ProjectID = TPT.ProjectID AND TPT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT2
				on TP.RefPjtID = TPT2.ProjectID AND TPT2.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_MEMBER TM
				on TP.Creator = TM.MemberID
			Left Outer Join XBOLTADM.TB_MEMBER TM2
				on TP.AuthorID = TM2.MemberID
			Left Outer Join XBOLTADM.TB_DICTIONARY TD
				on TP.Status = TD.TypeCode AND TD.LanguageID = 	#{languageID} 
				AND TD.Category = 'CSRSTS'
			Left Outer Join XBOLTADM.TB_DICTIONARY TD1
				on TP.AprvOption = TD1.TypeCode AND TD1.LanguageID = #{languageID}
				AND TD1.Category = 'APRVOPTION'
			Left Outer Join XBOLTADM.TB_DICTIONARY TD2
				on TP.Reason = TD2.TypeCode AND TD2.LanguageID = 	#{languageID}
				AND TD2.Category = 'CR'
			LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY WFSTEP 
				ON WFSTEP.LanguageID = #{languageID} AND TP.CurWFStepID = WFSTEP.TypeCode
				AND WFSTEP.Category = 'WFSTEP'	
			LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY WF 
				ON WF.LanguageID = #{languageID} AND TP.WFID = WF.TypeCode
				AND WF.Category = 'WF'
			LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY PRT 
				ON TP.Priority = PRT.TypeCode AND PRT.Category = 'PRT'
				AND PRT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_TEAM_TXT TTT
				on TP.OwnerTeamID = TTT.TeamID AND TTT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_TEAM_TXT TTT2 
				ON TTT2.TeamID = (Select TeamID From XBOLTADM.TB_MEMBER Where MemberID = TP.AuthorID )
				And TTT2.LanguageID = #{languageID}
				<if test="'APRV'.equals(Status)">
				Inner Join XBOLTADM.TB_WF_STEP_INST TW on TP.ProjectID = TW.ProjectID 
				 AND TW.Seq = (Select LastSeq From XBOLTADM.TB_WF_INST Where ProjectID = TP.ProjectID)
				 AND TW.ActorID =  #{sessionUserId}
				</if>			 
		<where>
			<if test="filter != null and filter != ''">
			TP.ProjectType = #{filter}
			</if>
			<if test="ParentID != null and ParentID != ''">
			AND TP.RefPjtID = #{ParentID}
			</if>
			<choose>
				<when test="'PG'.equals(screenType)">
				AND TP.RefPGID = #{refID}
				</when>
				<when test="'PJT'.equals(screenType)">
				AND TP.RefPjtID = #{refID}
				</when>
			</choose>
			<if test="pjtGRID != null and pjtGRID != ''">
			AND TP.RefPGID = #{pjtGRID}
			</if>
			<if test="projectID != null and projectID != ''">
			AND TP.RefPjtID = #{projectID}
			</if>
			<if test="curPJTID != null and curPJTID != ''">
			AND TP.ProjectID != #{curPJTID}
			</if>
			<if test="Category != null and Category != ''">
			AND TP.PJCategory = #{Category}
			</if>
			<if test="companyID != null and companyID != ''">
			AND TP.CompanyID = #{companyID}
			</if>
			<if test="loginUserId != null and loginUserId != ''">
			AND #{loginUserId} IN (SELECT MemberID FROM XBOLTADM.TB_PJT_MEMBER_REL WHERE ProjectID = TP.ProjectID)
			</if>			
			<choose>
				<when test='"ING".equals(Status)'>
					AND TP.Status NOT IN ('CLS','WTR')
				</when>
				<when test='"COMPL".equals(Status)'>
					AND TP.Status IN ('CLS','WTR')				
				</when>
				<when test="Status != null and Status != ''">
					AND TP.Status = #{Status} 
				</when>
			</choose>
			<if test="NotStatus != null and !NotStatus.equals('')">
				AND TP.Status NOT IN (${NotStatus})
			</if>
			<if test="CurWFStepID != null and CurWFStepID != ''">
			AND TP.CurWFStepID = #{CurWFStepID}
			</if>
			<if test="OwnerTeamID != null and OwnerTeamID != ''">
			AND TP.OwnerTeamID = #{OwnerTeamID}
			</if>
			<if test="Priority != null and Priority != ''">
			AND TP.Priority = #{Priority}
			</if>
			<if test="reason != null and reason != ''">
			AND TP.Reason = #{reason}
			</if>
			<if test="authorID != null and authorID != ''">
			AND ISNULL(TP.AuthorID,'') = #{authorID} 
			</if>
			<if test="relMemID != null and relMemID != ''">
			AND #{relMemID} in (SELECT MemberID FROM XBOLTADM.TB_PJT_MEMBER_REL WHERE ProjectID = TP.ProjectID)
			</if>
			<if test="memberId != null and memberId != ''">
			AND (ISNULL(TP.AuthorID,'') = #{memberId} OR #{memberId} in (SELECT MemberID FROM XBOLTADM.TB_PJT_MEMBER_REL WHERE ProjectID = TP.ProjectID))
			</if>
			<if test="ProjectID != null and ProjectID != ''">
			AND TP.ProjectID = #{ProjectID}
			</if>
			<if test="reqStartDt != null and reqStartDt != '' and reqEndDt != null and reqEndDt != ''">
				AND CONVERT(char(8),TP.StartDate, 112) BETWEEN #{reqStartDt} AND #{reqEndDt}
			</if>  
			<if test="clsStartDt != null and clsStartDt != '' and clsEndDt != null and clsEndDt != ''">
				AND CONVERT(char(8),TP.DueDate, 112) BETWEEN #{clsStartDt} AND #{clsEndDt}
			</if>  
			<if test="ProjectName != null and ProjectName != ''">
			AND TPT.Name like N'%'+#{ProjectName}+'%'
			</if>
			<if test='quickCheckOut != null and !quickCheckOut.equals("") and quickCheckOut.equals("Y") '>
				AND TP.Status IN('CSR','CNG')
			</if>
			<if test="ProjectCode != null and ProjectCode != ''">
				AND TP.ProjectCode like N'%'+#{ProjectCode}+'%'
			</if>
			<if test="AuthorName != null and AuthorName != ''">
				AND TM2.Name like N'%'+#{AuthorName}+'%'
			</if>
			<if test="AuthorTeamName != null and AuthorTeamName != ''">
				AND TTT2.Name like N'%'+#{AuthorTeamName}+'%'
			</if>
			<if test="companyID != null and companyID != ''">
			AND TP.CompanyID = #{companyID}
			</if>
						
		</where>
	ORDER BY
		TP.ProjectID  DESC
	</select>
	
	<select id="getMaxProjectID" resultType="String">
		SELECT
			ISNULL(MAX(ProjectID)+1, 1) as ProjectID
		FROM
			XBOLTADM.TB_PROJECT
	</select> 	
	
	<select id="getProjectType" resultType="String">
		SELECT
			rtrim(ProjectType)
		FROM
			XBOLTADM.TB_PROJECT
		WHERE
			ProjectID = #{s_itemID} 	
	</select> 	
	
	<!-- Project - group - Allocate Member -->
		<select id="projectGroupAllocateMember_gridList" resultType="java.util.HashMap">
			SELECT 
				Row_Number()OVER(ORDER BY TM.MemberID ASC ) as RNUM
				, CASE ISNULL(TMG.MemberID, '0') WHEN '0' THEN 0 ELSE 1 END CHK
				, TM.MemberID
				, TM.LoginID
				, ISNULL(TM.Name,'') AS UserName
				, TM.LoginID
				, TM.Addr1
				, Convert(varchar(20), TM.RegDate, 111) AS RegDate
				, ISNULL(TDML.Name, '') AS AuthorityName
				, ISNULL(TM.TeamID,'') AS TeamID
				, ISNULL(TTT.Name,'') AS TeamName
				, ISNULL(TM.CompanyID,'') AS CompanyID
				, ISNULL(TMC.Name,'') AS CompanyName				
			FROM 
				XBOLTADM.TB_MEMBER TM
				Left Outer Join XBOLTADM.TB_MEMBER_GR TMG
				on TMG.MemberID in (
					SELECT MemberID FROM XBOLTADM.TB_PJT_MEMBER_REL
					WHERE ProjectID = #{s_itemID}
				)AND TM.MemberID = TMG.MemberID
				Left Outer Join XBOLTADM.TB_TEAM_TXT TTT
					on TM.TeamID = TTT.TeamID
					ANd TTT.LanguageID = #{languageID}
				Left Outer Join XBOLTADM.TB_TEAM_TXT TMC
					on TM.CompanyID = TMC.TeamID
					AND TMC.LanguageID = #{languageID}	
				Left outer Join XBOLTADM.TB_DICTIONARY TDML
					on TM.MLVL = TDML.TypeCode 
					AND TDML.Category='MLVL'
					AND	TDML.LanguageID = #{languageID}	
			WHERE 
				1=1
	</select>
	
	<select id="wfStepInstAgrAprList_gridList" resultType="java.util.HashMap">
	SELECT 
			Row_Number()OVER(ORDER BY  TW.StepInstID ASC) as RNUM 
			, 0 AS CHK 
			, TP.ProjectID
			, XBOLTADM.fn_GetMyAbsPathForProject(TP.ProjectID, #{LanguageID}) AS Path
			, TP.ProjectCode
			, TPT.Name AS ProjectName
			, TPT2.Name AS ParentName
			, TPT.Description
			, ISNULL(TM.Name,'') AS CreatorName
			, ISNULL(CONVERT(char(10),TP.CreationTime, 111),'') as CreationTime
			, TD.Name AS StatusName
			, TP.ProjectType
			, TP.WFID
			, TP.CurWFStepID
			, TP.Seq
			, TP.AuthorID
			, TW.ActorID
			, GOV.Name AS GovName
			, TW.Status
			, CASE WHEN TW.Status = '0' THEN TGD2.Name ELSE TGD1.Name END ISDONE 
			, CASE WHEN TW.Status = '0' THEN '0' ELSE '2' END ISDONE2
			, TW.WFStepID
			, TW.StepInstID
			, WF.Name As WFName
		FROM 
			XBOLTADM.TB_PROJECT TP
			Inner Join XBOLTADM.TB_WF_STEP_INST TW
				on TP.ProjectID = TW.ProjectID 
					 AND (TP.CurWFStepID = TW.WFStepID or TW.Status != '0')
					 AND TW.ActorID =  #{AuthorID}
			Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT
				on TP.ProjectID = TPT.ProjectID AND TPT.LanguageID = #{LanguageID}
			Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT2
				on TP.RefPjtID = TPT2.ProjectID AND TPT2.LanguageID = #{LanguageID}
			Left Outer Join XBOLTADM.TB_MEMBER TM
				on TP.Creator = TM.MemberID
			Left Outer Join XBOLTADM.TB_DICTIONARY TD
				on TP.Status = TD.TypeCode AND TD.LanguageID = 	#{LanguageID}
				AND TD.Category = 'PJTSTS'
			LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY GOV 
			ON GOV.LanguageID = #{LanguageID}
			AND TW.WFStepID = GOV.TypeCode
			AND GOV.Category = 'WFSTEP'	
			Left Outer Join XBOLTADM.TB_DICTIONARY TGD1	
			on TGD1.TypeCode = 'LN00118' 
			AND TGD1.LanguageID = #{LanguageID}
			AND TGD1.Category = 'LN'	
			Left Outer Join XBOLTADM.TB_DICTIONARY TGD2	
			on TGD2.TypeCode = 'LN00121' 
			AND TGD2.LanguageID = #{LanguageID}
			AND TGD2.Category = 'LN'
			
			LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY WF 
				ON WF.LanguageID = #{LanguageID} AND TP.WFID = WF.TypeCode
				AND WF.Category = 'WF'
						
		WHERE RTRIM(Tp.ProjectType) = 'CSR'
		<if test="Gov != null and Gov != ''">
		AND TW.WFStepID = #{Gov}			
		</if>
		<if test="IsDone != null and IsDone != ''">
			<choose>
				<when test='"0".equals(IsDone)'>
					AND TW.Status IN (0,1)
				</when>
				<when test='"2".equals(IsDone)'>
					AND TW.Status = #{IsDone}
				</when>
			</choose>			
		</if>
		
	</select>

	<select id="searchNamePop" resultType="java.util.HashMap">
		SELECT 
			 TM.Name AS UserName
			, TM.NameEN
			, TM.MemberID
			, TTT.Name AS TeamName
			, TM.LoginID
			, TM.EmployeeNum
			, TM.TeamID
			, XBOLTADM.fn_GetMyAbsPathForOrg(TM.TeamID , #{languageID}) + '/' + TTT.Name AS TeamPath
			, CMP.Name As CompanyName
			, TM.Position
			, TM.Email
			, ISNULL(TM.Photo,'blank_photo.png') AS Photo
		FROM
			XBOLTADM.TB_MEMBER TM
			Left Outer Join XBOLTADM.TB_TEAM_TXT TTT On TM.TeamID = TTT.TeamID  AND TTT.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_TEAM_TXT CMP On TM.CompanyID = CMP.TeamID  AND CMP.LanguageID = #{languageID}
		WHERE 
			<choose>
				<when test="searchKey.equals('Name')">
					TM.Name Like '%'+#{searchValue}+'%'
				</when>
				<when test="searchKey.equals('ID')">
					TM.LoginID Like '%'+#{searchValue}+'%'
				</when>
				<otherwise>
					TM.Name Like '%'+#{searchValue}+'%'
				</otherwise>
			</choose>
			<if test="UserLevel == null or !UserLevel.equals('ALL')">
				AND TM.Authority != 4	
			</if>
			<if test="teamID != '' and teamID != null">
				AND TM.TeamID = #{teamID}
			</if>
			AND TM.Active = 1
	</select>
	
	<select id="searchPjtNamePop" resultType="java.util.HashMap">
		SELECT 
			 TM.Name AS UserName
			, TM.MemberID
			, TTT.Name AS TeamName
			, TM.LoginID
			, TM.EmployeeNum
			, TM.TeamID
			, XBOLTADM.fn_GetMyAbsPathForOrg(TM.TeamID , #{languageID}) + '/' + TTT.Name AS TeamPath
		FROM
			XBOLTADM.TB_MEMBER TM
			Left Outer Join XBOLTADM.TB_TEAM_TXT TTT On TM.TeamID = TTT.TeamID  AND TTT.LanguageID = #{languageID}
		Where TM.Active = 1
			<if test="projectCode != null and projectCode != ''">
			AND TM.MemberID NOT IN (
				Select TPMR.MemberID From XBOLTADM.TB_PJT_MEMBER_REL TPMR Left Join XBOLTADM.TB_PROJECT TP ON  TPMR.ProjectID = TP.ProjectID
				WHERE TP.ProjectCode = #{projectCode}
				) 
			</if>
			<if test="searchValue != null and searchValue != ''">
				<choose>
					<when test="searchKey.equals('Name')">
						AND TM.Name Like '%'+#{searchValue}+'%'
					</when>
					<when test="searchKey.equals('ID')">
						AND TM.MemberID Like '%'+#{searchValue}+'%'
					</when>
				</choose>
			</if>
			<if test="teamID != null and teamID != ''">
			AND TM.TeamID = #{teamID}	
			</if>
			<if test="!'ALL'.equals(UserLevel)">
			AND TM.Authority != 4
			</if>
	</select>

	<select id="searchTeamPop" resultType="java.util.HashMap">
		SELECT 
			TM.TeamID
			, XBOLTADM.fn_GetMyAbsPathForOrg(TM.TeamID , #{languageID}) AS ParentName
			, TTT.Name AS TeamName
		FROM
			XBOLTADM.TB_TEAM TM
			Left Outer Join XBOLTADM.TB_TEAM_TXT TTT On TM.TeamID = TTT.TeamID  AND TTT.LanguageID = #{languageID}
		WHERE
			<if test='!"N".equals(teamTypeYN)'>
			TM.TeamType = '4' AND 
			</if>
			TTT.Name Like N'%'+#{Name}+'%'
	</select>
	
	<select id="getPjtWorkerList_gridList" resultType="java.util.HashMap">
	SELECT 
			Row_Number()OVER(ORDER BY UserName) as RNUM
			, MemberID
			, 0 as CHK
			, UserName
			, TeamName
			, LoginID
			, Email
			, TeamPath
			, Position
			, MTelNum
			, Authority
			, MLVL
			, MemberName
			, EmployeeNums	
			, MemberInfo
			, MAX(RegDate) AS RegDate
			<if test='"Y".equals(assignmentYN )'>
			, Photo
			</if>
			, CompanyName
  	FROM (
			SELECT  Top 500			      
				  TM.MemberID
				, TM.Name + Case When ISNULL(TM.NameEN,'') != '' Then '(' + ISNULL(TM.NameEN,'') + ')' Else '' End AS UserName
				, TTT.Name AS TeamName
				, TM.LoginID
				, TM.Email
				, XBOLTADM.fn_GetMyAbsPathForOrg(TM.TeamID , #{languageID}) + '/' + TTT.Name AS TeamPath
				, ISNULL(TM.Position, '') As Position
				, ISNULL(TM.MTelNum, '') As MTelNum
				, ISNULL(CONVERT(varchar(20),PMR.AssignedDate, 111),'') As RegDate
				, TM.Authority
				, TM.MLVL
				, TM.Name
					+Case When ISNULL(TM.EMAIL,'') != '' Then '/' +ISNULL(TM.EMAIL,'') Else '' End
					+Case When ISNULL(TTT.NAME,'') != '' Then '/' +ISNULL(TTT.NAME,'') Else '' End
					AS MemberName
				, <![CDATA[
				TM.EmployeeNum+'.jpg' As EmployeeNums,	
				ISNULL(TM.Name,'') +'/'+ISNULL(TTT2.Name,'') +'/'+ISNULL(TTT.NAME,'N/A') + '<BR>' + ISNULL(TM.Email,'') +'<BR>'
				+ ISNULL(TM.MTelNum,'') + Case When ISNULL(TM.TelNum,'') != '' Then  ', '  Else '' End + ISNULL(TM.TelNum,'') AS MemberInfo
				]]> 
				<if test='"Y".equals(assignmentYN )'>
				,Case When ISNULL(TM.Photo,'blank_photo.png') = 'blank_photo.png' Then #{blankPhotoUrlPath}
				Else CAST(#{photoUrlPath} AS varchar(50)) + ISNULL(TM.Photo,'blank_photo.png') END AS Photo
				</if>		
				, TTT2.Name As CompanyName	
			FROM XBOLTADM.TB_PJT_MEMBER_REL PMR,	 XBOLTADM.TB_MEMBER TM
	  		     Left Outer Join XBOLTADM.TB_TEAM_TXT TTT On TM.TeamID = TTT.TeamID  AND TTT.LanguageID = #{languageID}	 
	  		     Left Outer Join XBOLTADM.TB_TEAM_TXT TTT2 On TM.CompanyID = TTT2.TeamID  AND TTT2.LanguageID = #{languageID}	  		
		  	WHERE PMR.MemberID = TM.MemberID	AND TM.Active = 1	AND PMR.Involved = 1 
					
					<if test="projectID != null and projectID != ''">
					AND PMR.ProjectID = #{projectID}
					</if>
					<if test="!'ALL'.equals(UserLevel)">
					AND TM.Authority != 4
					</if>
					<if test="csrId != null and csrId != ''">
					AND TM.MemberID NOT IN (SELECT MemberID FROM XBOLTADM.TB_PJT_MEMBER_REL WHERE ProjectID = #{csrId})
					</if>
					<if test="userType != null and userType != ''">
					AND TM.UserType = #{userType}
					</if>
					<if test="teamId != null and teamId != ''">
					AND TM.TeamID = #{teamId}
					</if>
					<if test="searchValue != null and searchValue != ''">
						<choose>
							<when test="searchKey.equals('Name')">
								AND TM.Name Like N'%'+#{searchValue}+'%'
							</when>
							<when test="searchKey.equals('ID')">
								AND TM.LoginID Like N'%'+#{searchValue}+'%'
							</when>
						</choose>
					</if>
					<if test="Name != null and Name != ''">
					AND TM.Name Like N'%'+#{Name}+'%'
					</if>
			)A
	GROUP BY  MemberID, UserName, TeamName, LoginID	, Email, TeamPath, Position, MTelNum, Authority	, MLVL,  MemberName, EmployeeNums, MemberInfo, CompanyName		
			<if test='"Y".equals(assignmentYN )'>
			, Photo
			</if>			
	ORDER BY UserName
	</select>
	
	<select id="getMemberList_gridList" resultType="java.util.HashMap">		
		Select
			Row_Number()OVER(ORDER BY TM.Name) as RNUM, 
			TM.MemberID,
			TM.Name,
			TTT.Name AS TeamName,
			<![CDATA[
			TM.EmployeeNum+'.jpg' As EmployeeNum,	
			 ISNULL(TM.Name,'') +'/'+ISNULL(TMTXT.Name,'') +'/'+ISNULL(TTT.Name,'') + '<BR>' + ISNULL(TM.Email,'') +'<BR>'
			+ ISNULL(TM.MTelNum,'') + Case When ISNULL(TM.TelNum,'') != '' Then  ', '  Else '' End + ISNULL(TM.TelNum,'') AS MemberInfo,
			]]> 
			TM.Name+Case When ISNULL(TM.EMAIL,'') != '' Then '/' +ISNULL(TM.EMAIL,'') Else '' End AS MemberName
			<if test='"Y".equals(assignmentYN )'>
			,Case When ISNULL(TM.Photo,'blank_photo.png') = 'blank_photo.png' Then #{blankPhotoUrlPath}
			Else CAST(#{photoUrlPath} AS varchar(50)) + ISNULL(TM.Photo,'blank_photo.png') END AS Photo
			</if>		
		From XBOLTADM.TB_MEMBER TM
		Left Outer Join XBOLTADM.TB_TEAM_TXT TTT On TM.TeamID = TTT.TeamID  AND TTT.LanguageID = #{languageID}
		Left Outer Join XBOLTADM.TB_TEAM_TXT TMTXT ON TMTXT.TeamID = TM.CompanyID And TMTXT.LanguageID = #{languageID}
		Where TM.Active = 1
			<if test="projectID != null and projectID != ''">
			AND TM.MemberID NOT IN (Select MemberID From XBOLTADM.TB_PJT_MEMBER_REL Where ProjectID = #{projectID}) 
			</if>
			<if test="scheduleID != null and scheduleID != ''">
			AND TM.MemberID NOT IN (Select MemberID From XBOLTADM.TB_MY_SCHEDULE Where ScheduleID = #{scheduleID}) 
			</if>
			<if test="teamID != null and teamID != ''">
			AND TM.TeamID = #{teamID}
			</if>
			<if test="!'ALL'.equals(UserLevel)">
			AND TM.Authority != 4		
			</if>
			<if test='selectMember != null and !"".equals(selectMember)'>
				AND TM.MemberID NOT IN (${selectMember})
			</if>
			<if test="notInRoleCat != null and notInRoleCat != ''">
				 And TM.MemberID Not IN( Select Distinct MemberID from XBOLTADM.TB_MY_ITEM Where AssignmentType = #{notInRoleCat} ) 
			</if>
			<if test="searchValue != null and searchValue != ''">
				<choose>
					<when test="searchKey.equals('Name')">
						AND TM.Name Like N'%'+#{searchValue}+'%'
					</when>
					<when test="searchKey.equals('ID')">
						AND TM.LoginID Like N'%'+#{searchValue}+'%'
					</when>
				</choose>
			</if>
		ORDER BY TM.Name	
	</select>
	
	<select id="searchNewMember_gridList" resultType="java.util.HashMap">
		SELECT 
			Row_Number()OVER(ORDER BY TM.Name) as RNUM
			, TM.MemberID
			, TM.Name AS UserName
			, TTT.Name AS TeamName
			, TM.LoginID
			, TM.Email
			, XBOLTADM.fn_GetMyAbsPathForOrg(TM.TeamID , #{languageID}) + '/' + TTT.Name AS TeamPath
			, ISNULL(TM.Position, '') As Position
			, ISNULL(TM.MTelNum, '') As MTelNum
			, ISNULL(CONVERT(varchar(20),TM.RegDate, 111),'') As RegDate
			, TM.Authority
			, TM.MLVL
			, '' As CNT
		FROM
			XBOLTADM.TB_MEMBER TM
	  		Left Outer Join XBOLTADM.TB_TEAM_TXT TTT On TM.TeamID = TTT.TeamID  AND TTT.LanguageID = #{languageID}
	  	<where>
	  		<if test="'null'.equals(screenType)">
			TM.Authority != 4
			</if>
			<if test="projectID != null and projectID != ''">
			AND TM.MemberID NOT IN (SELECT MemberID FROM XBOLTADM.TB_PJT_MEMBER_REL WHERE ProjectID = #{projectID})
			</if>
			<if test="userType != null and userType != ''">
			AND TM.UserType = #{userType}
			</if>
			<if test="teamId != null and teamId != ''">
			AND TM.TeamID = #{teamId}
			</if>
			<if test="searchValue != null and searchValue != ''">
				<choose>
					<when test="searchKey.equals('Name')">
						AND TM.Name Like N'%'+#{searchValue}+'%'
					</when>
					<when test="searchKey.equals('ID')">
						AND TM.LoginID Like N'%'+#{searchValue}+'%'
					</when>
				</choose>
			</if>
			<if test="groupID != null and groupID != ''">
			AND TM.MemberID NOT IN (Select MemberID From XBOLTADM.TB_MEMBER_GR Where GroupID = #{groupID} )	
			</if>
	  	</where>
		 ORDER BY TM.Name
	</select>
	
	<select id="deleteNamePop" resultType="java.util.HashMap">
		SELECT 
			 TM.Name AS UserName
			, TM.MemberID
			, TTT.Name AS TeamName
		FROM
			XBOLTADM.TB_MEMBER TM
			Left Outer Join XBOLTADM.TB_TEAM_TXT TTT On TM.TeamID = TTT.TeamID  AND TTT.LanguageID = #{languageID}
		WHERE
			TM.MemberID IN 
					<foreach collection="MemberID" index="index" item="item" open="(" close=")"  separator=",">
						${item}
					</foreach>
			<if test="csrUserID != null and csrUserID != ''">
			AND TM.MemberID != #{csrUserID}
			</if>
	</select>
 	
 	<delete id="DelProject" parameterType="java.util.HashMap">
 		DELETE 
 		FROM
 			XBOLTADM.TB_PROJECT_TXT
		WHERE
			<if test="ItemID != null and ItemID != ''">
			ProjectID = #{ItemID}
			</if>
			<if test="pjtIds! = null and pjtIds.size > 0">
			ProjectID IN 
				<foreach collection="pjtIds" index="index" item="item" open="(" close=")"  separator=",">
					${item}
				</foreach>
			</if>
		
		DELETE 
 		FROM
 			XBOLTADM.TB_PJT_FILE
		WHERE
			<if test="ItemID != null and ItemID != ''">
			ProjectID = #{ItemID}
			</if>
			<if test="pjtIds! = null and pjtIds.size > 0">
			ProjectID IN 
				<foreach collection="pjtIds" index="index" item="item" open="(" close=")"  separator=",">
					${item}
				</foreach>
			</if>
		
		DELETE 
 		FROM
 			XBOLTADM.TB_PJT_MEMBER_REL
		WHERE
			<if test="ItemID != null and ItemID != ''">
			ProjectID = #{ItemID}
			</if>
			<if test="pjtIds.size > 0">
			ProjectID IN 
				<foreach collection="pjtIds" index="index" item="item" open="(" close=")"  separator=",">
					${item}
				</foreach>
			</if>
 	
 	
 		DELETE 
 		FROM
 			XBOLTADM.TB_PROJECT
		WHERE
			<if test="ItemID != null and ItemID != ''">
			ProjectID = #{ItemID}
			</if>
			<if test="pjtIds.size > 0">
			ProjectID IN 
				<foreach collection="pjtIds" index="index" item="item" open="(" close=")"  separator=",">
					${item}
				</foreach>
			</if>
 	</delete>
 	
 
 	<select id="s_itemIDentifierFromGuid" resultType="String">
		SELECT 
			IdentiFier
		FROM 
			XBOLTADM.TB_ITEM
		WHERE 
			GlobalID = #{GlobalID}
			AND ItemTypeCode = 'OJ00001' 	
 	</select>
 
 	<select id="getMaxID" resultType="String">
		SELECT
			ISNULL(MAX(ItemID)+1, 10001) as ItemID
		FROM
			XBOLTADM.TB_ITEM
		WHERE 
			ItemID Between 10000 and 20000	
	</select>

 	<!-- 프로세스 ID/NAME 조건 검색 목록 받아오기 -->
 <select id="s_itemIDNameProcessList" resultType="java.util.HashMap">
 
 			SELECT
				DISTINCT C.ItemID, C.ToItemID, D.PlainText, E.PlainText as FromText
			FROM 
				XBOLTADM.TB_ITEM C, XBOLTADM.TB_ITEM_ATTR D, XBOLTADM.TB_ITEM_ATTR E
				
			WHERE 
				 C.ToItemID = D.ItemID
				and C.FromItemID = E.ItemID
				and C.ToItemID not in (SELECT ToItemID from XBOLTADM.TB_ITEM where FromItemID =  #{ITEM_ID} AND Deleted != 'N' ) 
				and D.AttrTypeCode = 'AT00001'
				and E.AttrTypeCode = 'AT00001'
				and C.ItemTypeCode = 'ST00003'
				and  C.ToItemCategory = 'MD'
				and D.PlainText 
					LIKE '%'+#{searchIDName}+'%'
				or
				 C.ToItemID = D.ItemID
				and C.FromItemID = E.ItemID
				and C.ToItemID not in (SELECT ToItemID from XBOLTADM.TB_ITEM where FromItemID =  #{ITEM_ID} AND Deleted != 'N') 
				and D.AttrTypeCode = 'AT00001'
				and E.AttrTypeCode = 'AT00001'
				and C.ItemTypeCode = 'ST00003'
				and  C.ToItemCategory = 'MD'
				and C.ToItemID 
					LIKE '%'+#{searchIDName}+'%'
 </select>

 	<!-- 프로세스 부서 조건 검색 목록 받아오기 -->
 <select id="getOrgProcessList" resultType="java.util.HashMap">
 
 			SELECT
				DISTINCT C.ItemID, C.ToItemID, D.PlainText, E.PlainText as FromText
			FROM 
				XBOLTADM.TB_ITEM C, XBOLTADM.TB_ITEM_ATTR D, XBOLTADM.TB_ITEM_ATTR E
				
			WHERE 
				 C.ToItemID = D.ItemID
				and C.FromItemID = E.ItemID
				and C.ToItemID not in (SELECT ToItemID from XBOLTADM.TB_ITEM where FromItemID =  #{ITEM_ID} AND Deleted != 'N') 
				and D.AttrTypeCode = 'AT00001'
				and E.AttrTypeCode = 'AT00001'
				and C.ItemTypeCode = 'ST00003'
				and  C.ToItemCategory = 'MD'
				and E.PlainText
					LIKE '%'+#{searchOrg}+'%'
 </select>
 
  	<!-- 프로세스 ID/NAME & 부서 조건 검색 목록 받아오기 -->
  <select id="getTweenSearchProcessList" resultType="java.util.HashMap">
 
 			SELECT
				DISTINCT C.ItemID, C.ToItemID, D.PlainText, E.PlainText as FromText
			FROM 
				XBOLTADM.TB_ITEM C, XBOLTADM.TB_ITEM_ATTR D, XBOLTADM.TB_ITEM_ATTR E
				
			WHERE 
				 C.ToItemID = D.ItemID
				and C.FromItemID = E.ItemID
				and C.ToItemID not in (SELECT ToItemID from XBOLTADM.TB_ITEM where FromItemID =  #{ITEM_ID} AND Deleted != 'N') 
				and D.AttrTypeCode = 'AT00001'
				and E.AttrTypeCode = 'AT00001'
				and C.ItemTypeCode = 'ST00003'
				and  C.ToItemCategory = 'MD'
				and D.PlainText 
					LIKE '%'+#{searchIDName}+'%'
				and E.PlainText
					LIKE '%'+#{searchOrg}+'%'
				or
				 C.ToItemID = D.ItemID
				and C.FromItemID = E.ItemID
				and C.ToItemID not in (SELECT ToItemID from XBOLTADM.TB_ITEM where FromItemID =  #{ITEM_ID} AND Deleted != 'N') 
				and D.AttrTypeCode = 'AT00001'
				and E.AttrTypeCode = 'AT00001'
				and C.ItemTypeCode = 'ST00003'
				and  C.ToItemCategory = 'MD'
				and C.ToItemID 
					LIKE '%'+#{searchIDName}+'%'
				and E.PlainText
					LIKE '%'+#{searchOrg}+'%'
 </select>


<select id="getProjectListInfo" resultType="java.util.HashMap">
	  SELECT 
	  		C.PlainText AS checkCode
	  		, D.PlainText AS createDay
	  		, E.PlainText AS completeDay
	  		, F.Value AS progressStep
	  		, G.PlainText AS CreaterName
	  FROM 
	  		XBOLTADM.TB_ITEM A
			left outer join XBOLTADM.TB_ITEM_ATTR C on A.ToItemID = C.ItemID AND C.AttrTypeCode = 'AT00000'
			left outer join XBOLTADM.TB_ITEM_ATTR D on A.ToItemID = D.ItemID AND D.AttrTypeCode = 'AT00027' AND D.LovCode = 'LV00301'
			left outer join XBOLTADM.TB_ITEM_ATTR E on A.ToItemID = E.ItemID AND E.AttrTypeCode = 'AT00027' AND E.LovCode = 'LV00308'
			left outer join XBOLTADM.TB_ATTR_TYPE_LOV F on F.AttrTypeCode = 'AT00027' AND F.LovCode = A.ProgressStatus
			left outer join XBOLTADM.TB_ITEM_ATTR G on A.ToItemID = G.ItemID AND G.AttrTypeCode = 'AT00028'
	 WHERE 
		A.FromItemID = (
			SELECT 
				ItemID 
			FROM 
				XBOLTADM.TB_ARCHITECTURE WHERE ArchitectureCode = #{ArchCode}
		)		
	

</select>

<select id="getPrjTmpArc_gridList" resultType="java.util.HashMap">
	SELECT 
		Row_Number()OVER(ORDER BY TML.TemplCode ASC, TAT.ArcCode ASC ) as RNUM
		, CASE CTAT.ArcCode WHEN CTAT.ArcCode THEN '1' ELSE '0' END CHK	
		, ISNULL(TML.TemplCode,'') AS TemplCode
		, ISNULL(TD.Name,'') AS TmName
		, TAT.ArcCode
		, ISNULL(TDTA.Name,'') AS ArcName
	FROM 
		XBOLTADM.TB_TEMPL TML
		Right Outer Join XBOLTADM.TB_ARC_TEMPL TAT
		on TML.TemplCode = TAT.TemplCode 
		Left Outer Join XBOLTADM.TB_ARC_TEMPL CTAT
		on CTAT.ArcCode = TAT.ArcCode AND CTAT.ProjectID = #{s_itemID}
		Left Outer join XBOLTADM.TB_DICTIONARY TD
		on TML.TemplCode = TD.TypeCode AND TD.LanguageID =  #{languageID}
		Left Outer Join XBOLTADM.TB_DICTIONARY TDTA
		on TAT.ArcCode = TDTA.TypeCode AND TDTA.LanguageID =  #{languageID}
	<where>
		<if test="getCode != null and getCode != ''">
			TAT.TemplCode = #{getCode}	
		</if>
	</where>
	Order By
		TML.TemplCode ASC, TAT.ArcCode ASC	
</select>

<select id="getPrjItem_gridList" resultType="java.util.HashMap">
SELECT 
		DISTINCT 
		TI.ItemID
		, 0 AS CHK 
		, Row_Number()OVER(ORDER BY TIA.PlainText ASC ) as RNUM
		, TI.ClassCode
		, TI.Version
		, TI.Identifier
		, TI.LastUpdated
		, TIA.PlainText as ItemName
		, TD.Name as ClassName
		, ISNULL(TT.Name, '') as TeamName
		, TOT.Name as OwnerTeamName
		, TM.Name AS Name
		, TIF.PlainText as ProcessInfo
		
	FROM 
		XBOLTADM.TB_ITEM TI
	
		LEFT OUTER JOIN XBOLTADM.TB_ITEM_ATTR TIA 
		ON TIA.AttrTypeCode = 'AT00001'
		AND TIA.LanguageID = #{languageID}
		AND TI.ItemID = TIA.ItemID 
		
		LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY TD 
		ON TD.LanguageID = #{languageID}
		AND TI.ClassCode = TD.TypeCode
		
		LEFT OUTER JOIN XBOLTADM.TB_TEAM_TXT TT 
		ON TT.LanguageID = #{languageID}
		AND TI.CompanyID = TT.TeamID	
		
		LEFT OUTER JOIN XBOLTADM.TB_TEAM_TXT TOT 
		ON TOT.LanguageID = #{languageID}
		AND TI.OwnerTeamID = TOT.TeamID 

		LEFT OUTER JOIN XBOLTADM.TB_MEMBER TM 
		ON TI.LastUser = TM.MemberID
		
		LEFT OUTER JOIN XBOLTADM.TB_ITEM_ATTR TIF 
		ON TIF.LanguageID = #{languageID}
		AND TIF.AttrTypeCode = 'AT00003'
		AND TI.FromItemID = TIF.ItemID	
	WHERE
		TI.ProjectID = #{s_itemID}		
		AND TI.CategoryCode = 'OJ'
	
</select>
 
 <select id="getTopProjectID" resultType="String">
 
	SELECT
	 	Max(ItemID) as ItemID 
	FROM
	 	XBOLTADM.TB_ITEM
	WHERE 
		CategoryCode = 'CH'
		AND ItemTypeCode = 'CH00002'
 
 </select>
 
  <select id="getBefProjectID" resultType="String">
 
	SELECT
	 	Max(ItemID) as ItemID 
	FROM
	 	XBOLTADM.TB_ITEM
	WHERE 
		CategoryCode = 'CH'
		AND ItemTypeCode = 'CH00002'
		AND ItemID != #{s_itemID}
 
 </select>
 
 <select id="getFunctionTypeFromGuid" resultType="String">
 		SELECT 
			FunctionType
		FROM 
			XBOLTADM.TB_ITEM
		WHERE 
			GlobalID = #{GlobalID}
			AND ItemTypeCode = 'OJ00001' 	
 </select>
 
  	<!-- 미매핑 프로세스 카운트 -->
 <select id="getNoMapCount" resultType="String">
 	SELECT 
 		ISNULL(COUNT(ItemID),0) as ItemIDCount
	FROM 
		[XBOLTADM].[TB_ITEM] M
	WHERE	
		M.ItemTypeCode = 'OJ00001'
		and M.CategoryCode = 'MD'
		and M.ClassCode = 'P'
		and M.ProjectID		= #{s_itemID}				--	ProjectID 글로벌 변수로 갖고 있어서 입력해줘야 함
		and M.ItemID NOT IN 
			(	
				SELECT 
					ToItemID  
				FROM 
					[XBOLTADM].[TB_ITEM]
				WHERE
					ItemTypeCode = 'ST00003'		--	조직과 프로세스간 관계
					and ProjectID		=  #{s_itemID}	--	ProjectID 글로벌 변수로 갖고 있어서 입력해줘야 함	
					and ToItemID is not null		--	에러체크용
				GROUP BY ToItemID
			)
 </select>
 
  
	<insert id="insertItem" parameterType="java.util.HashMap">
		INSERT INTO XBOLTADM.TB_ITEM
			(
				[CreationTime]
				,[Level]
				,[ProjectID]
				,[CategoryCode]
				,[ClassCode]
				
				,[CompanyID]
				,[ItemID]
				,[ItemTypeCode]
				,[FromItemID]
				,[ToItemID]
				
				,[Identifier]
				,[ToItemCategory]
				,[ToItemTypeCode]
				,[Deleted]
				,[ProgressStatus]
			) VALUES (
				 getDate()
				,#{Level}
				,#{ProjectID}
				,#{CategoryCode}
				,#{ClassCode}
				
				,#{CompanyID}
				,#{ItemID}
				,#{ItemTypeCode}
				,#{FromItemID}
				,#{ToItemID}
				
				,#{Identifier}
				,#{ToItemCategory}
				,#{ToItemTypeCode}
				,#{Deleted}
				,#{ProcessStatus}
			)
	</insert>


 	<update id="setOccInfo" parameterType="java.util.HashMap">
		BEGIN TRAN
 	
		UPDATE 
			XBOLTADM.TB_ITEM_ATTR
		SET
			PlainText = #{PlainText}
		WHERE
			ItemID = #{ItemID}  
			and Language = #{Languqge}
			and AttrTypeCode = #{AttrTypeCode}
		COMMIT	
	</update>
 
  	<update id="processInfoUpdate" parameterType="java.util.HashMap">
		BEGIN TRAN
  	
		UPDATE 
			XBOLTADM.TB_ITEM
		SET
			FromItemID = #{ToItemID}
		WHERE
			ItemID = #{ItemID}
		COMMIT
	</update>
 
	
	<select id="getChangeSetStep" resultType="java.util.HashMap">
		SELECT ChangeSetID
      		, ItemID
      		, (SELECT Name FROM XBOLTADM.TB_MEMBER WHERE MemberID = InChargeUser) As InChargeUserName
      		, InChargeUser
      		, ProgramStatus
      		, ISNULL(CONVERT(char(10), PlannedStartDate, 120),'') as PlannedStartDate
	        , ISNULL(CONVERT(char(10), PlannedEndDate, 120),'') as PlannedEndDate
	        , ISNULL(CONVERT(char(10), ActualStartDate, 120),'') as ActualStartDate
	        , ISNULL(CONVERT(char(10), ActualEndDate, 120),'') as ActualEndDate
      		, Status
      		, UTScenarioStatus
      		, IfMappingName 
      		, ISNULL(CONVERT(char(10), LegacyPlannedEndDate, 120),'') as LegacyPlannedEndDate
      		, ISNULL(CONVERT(char(10), LegacyActualEndDate, 120),'') as LegacyActualEndDate
      		, ISNULL(CONVERT(char(10), EAIEndDate, 120),'') as EAIEndDate
      		, ISNULL(CONVERT(char(10), MWUtEndDate, 120),'') as MWUtEndDate
      	FROM XBOLTADM.TB_SAP_DEV
      	WHERE ItemID = #{ItemID}
      	AND ChangeSetID = #{ChangeSetID}
      	AND ProgramStatus = #{ProgramStatus}
	</select>
	
	
	<select id="getProjectCategory" resultType="java.util.HashMap">
		SELECT PJCategory, Reason
      	FROM XBOLTADM.TB_PROJECT
      	WHERE ProjectID = #{projectID}
	</select>
	
	<select id="getItemInfo" resultType="java.util.HashMap">
		SELECT 
      		 ItemTypeCode, ClassCode, AuthorID, Status, Blocked, CurChangeSet
      	FROM XBOLTADM.TB_ITEM
  		WHERE ItemID = #{s_itemID}
	</select>
	
	<select id="getUserInfo" resultType="java.util.HashMap">
		SELECT MemberID
      		 , Name
      		 , CompanyID
      		 , TeamID      
  		FROM XBOLTADM.TB_MEMBER
  		<where>
			<if test="userId != null and userId != ''">
				MemberID = #{userId}		
			</if>
		</where>	
	</select>
	
	<select id="getStatus" resultType="java.util.HashMap">
		SELECT TypeCode
		      , LanguageID
		      , Category
		      , Name
		      , Description
		      , ClientID
		  FROM XBOLTADM.TB_DICTIONARY
		  WHERE Category = 'PJTSTS'
		  AND LanguageID = #{LanguageID}
		  ORDER BY TypeCode DESC
	</select>
	
	<select id="getProjectNameList" resultType="java.util.HashMap">
	SELECT DISTINCT
			T2.ProjectID
			, T1.Name
			, TPJ.ProjectCode
			, (T3.Name + '/' + T1.Name) AS PJTFullName
	  	FROM XBOLTADM.TB_PROJECT TPJ
	  		Left Outer Join XBOLTADM.TB_PROJECT_TXT T1 ON T1.ProjectID = TPJ.ProjectID  AND T1.LanguageID = #{LanguageID}
	  		Left Outer Join XBOLTADM.TB_PJT_MEMBER_REL T2	ON T2.ProjectID = TPJ.ProjectID 
	  		Left Outer Join XBOLTADM.TB_PROJECT_TXT T3 on TPJ.RefPjtID = T3.ProjectID AND T3.LanguageID = #{LanguageID}
	  		<if test="s_itemID != null and s_itemID != ''">
	  		, XBOLTADM.TB_ITEM ITM
			</if>
	  	WHERE 1=1 
			<if test="s_itemID != null and s_itemID != ''">
				AND ITM.ItemID IN (${s_itemID})	
			</if>
			<if test="userId != null and userId != ''">
				AND T2.MemberID = #{userId}
				<!-- AND ITM.AuthorID = #{userId} -->		
			</if>
			<if test="ProjectType != null and ProjectType != ''">
				AND TPJ.ProjectType = #{ProjectType}	
				<if test="s_itemID != null and s_itemID != '' and checkInOption != null and checkInOption == '02'">
					AND T1.ProjectID NOT IN (SELECT ProjectID FROM XBOLTADM.TB_CHANGE_SET WHERE ItemID IN (${s_itemID}))
				</if>
			</if>
			<if test="isMainItem != null and isMainItem != ''">
				AND TPJ.Status IN ('CSR','CNG') 
			</if>
			<if test="status != null and status != ''">
				AND TPJ.Status = #{status}
			</if>
			<if test="processID != null and processID != ''">
				AND TPJ.ProjectCode NOT IN (SELECT DocumentNo FROM XBOLTAPP.PIM_PROC_INST WHERE ProcessID = #{processID})
			</if>
			<if test="pjCategory != null and pjCategory != ''">
				AND TPJ.PJCategory = #{pjCategory}
			</if>
		ORDER BY ProjectID	
	</select>
	
	<select id="getChangeSetInsertInfo" resultType="java.util.HashMap">
		SELECT TypeCode
      		, LanguageID
      		, Category
      		, Name
      		, SortNum
      		, Description
      		, ClientID
  		FROM XBOLTADM.TB_DICTIONARY
 	 	WHERE Category = #{Category}
  		AND LanguageID = #{LanguageID}
		<if test="TypeCode != null and TypeCode != ''">
			AND TypeCode = #{TypeCode}	
		</if>
  		ORDER BY SortNum, TypeCode
	</select>
	
	<select id="getRootItemID" resultType="String">
		SELECT FromItemID
    	FROM XBOLTADM.TB_ITEM
  		WHERE ToItemID = #{parentID}
  		<if test="categoryCode != null and categoryCode != ''">
			AND CategoryCode = #{categoryCode}	
		</if>
	</select>
	
	<select id="getExtensionFunc" resultType="String">
		SELECT ISNULL(ExtFunc, '') as ExtFunc
  		FROM XBOLTADM.TB_ITEM_CLASS
  		WHERE ItemClassCode = #{classCode}
	</select>
	
	<select id="getItemStatus" resultType="String">
		SELECT Status
    	FROM XBOLTADM.TB_ITEM
  		WHERE ItemID = #{s_itemID}
	</select>
	
	<select id="getItemBlocked" resultType="String">
		SELECT Blocked
    	FROM XBOLTADM.TB_ITEM
  		WHERE ItemID = #{s_itemID}
	</select>
	
	<select id="getItemAuthorIDAndLockOwner" resultType="java.util.HashMap">
		SELECT AuthorID, LockOwner, Blocked
    	FROM XBOLTADM.TB_ITEM
  		WHERE ItemID = #{s_itemID}
	</select>

	<select id="getItemConvertStatus" resultType="String">
		SELECT 
			CASE Status 
				WHEN 'NEW1' THEN CONVERT(varchar(3), Status) 
				WHEN 'DEL1' THEN CONVERT(varchar(3), Status) 
				ELSE 'MOD' END AS CNGT
    	FROM XBOLTADM.TB_ITEM
  			WHERE ItemID = #{s_itemID}
	</select>
	
	<select id="getWfStepId" resultType="String">
  		SELECT ISNULL(WFStepID, '') AS WFStepID
    	FROM XBOLTADM.TB_WF_STEP_REL
  		WHERE 
  		WFID = #{WFID}
  		AND PreStepID = #{PreStepID}
	</select>
	
	<select id="getMemberIdWithRolType" resultType="java.util.HashMap">
  		SELECT MemberID
      	FROM XBOLTADM.TB_MY_ITEM
  		WHERE ItemID = #{ItemID}
  		AND AssignmentType = 'GOV'
  		AND RoleType = #{RoleType}
	</select>
	
	<select id="getSameRolTypeData" resultType="java.util.HashMap">
  		SELECT
      		WFStepID
      		, ActorID
      		, Event
  		FROM XBOLTADM.TB_WF_STEP_INST
  		WHERE
  			WFID = #{WFID} 
  			AND ChangeSetID = #{ChangeSetID} 
  			AND WFStepID = #{WFStepID} 
  			AND ActorID != #{userID}
	</select>
	
	<select id="getGovNameList" resultType="java.util.HashMap">
  		SELECT 
			Distinct
			 GOV.Name AS Name
			, TW.WFStepID AS TypeCode
		FROM 
			XBOLTADM.TB_PROJECT TP
			Inner Join XBOLTADM.TB_WF_STEP_INST TW
				on TP.ProjectID = TW.ProjectID 
					 AND (TP.CurWFStepID = TW.WFStepID or TW.Status != '0')
					 AND TW.WFStepID NOT IN('CSR', 'CNG') 
					 AND TW.ActorID =  #{ActorID}
			
			LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY GOV 
			ON GOV.LanguageID = #{LanguageID}
			AND TW.WFStepID = GOV.TypeCode
			AND GOV.Category = 'WFSTEP'	
			
		WHERE RTRIM(Tp.ProjectType) = 'CSR'
	</select>
	
	
	<select id="getParentPjtInfo" resultType="java.util.HashMap">
  		SELECT
  			TP.ProjectID 
  			, TP.TemplCode
      		, TP.Prefix
      		, TP.RefPGID
      		, TP.RefPjtID
      		, TP.AprvOption
      		, TD.Name As AprvOptionNM
      		, TP.CheckInOption
      		, TP.ClosingOption
  		FROM XBOLTADM.TB_PROJECT TP
  		      Left Outer Join XBOLTADM.TB_DICTIONARY TD	on TP.AprvOption = TD.TypeCode AND TD.LanguageID = #{languageID}
				AND TD.Category = 'APRVOPTION'
  		WHERE
  			ProjectID = #{ProjectID} 
	</select>
		
	<select id="getParentPjtList" resultType="java.util.HashMap">
  		SELECT TP.ProjectID As CODE
      		 , TPT.Name As NAME
      		 , TP.Status
      		 , TP.ProjectCode As PCODE
      		 , TM.Name AS MemName
			 , CONVERT(varchar(14),TP.CreationTime,111) as CreationTime
			 , TP.ProjectType
  		FROM XBOLTADM.TB_PROJECT TP
  		Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT
				on TP.ProjectID = TPT.ProjectID AND TPT.LanguageID = #{languageID}
  		Left Outer Join XBOLTADM.TB_MEMBER TM
				on TP.AuthorID = TM.MemberID
  		WHERE RTRIM(TP.ProjectType) = #{ProjectType}
  		    AND Deactivated != 1
			<if test="ParentID != null and ParentID != ''">
				AND TP.RefPjtID = #{ParentID}	
			</if>
			<if test="ProjectID != null and ProjectID != ''">
				AND TP.ProjectID = #{projectID}	
			</if>
			<if test="Creator != null and Creator != ''">
				AND TP.Creator = #{Creator}
			</if>
			<if test="InStatus != null and InStatus != ''">
				AND TP.Status IN (${InStatus})
			</if>
			<if test="Status != null and Status != ''">
				AND TP.Status != 'CLS' 
			</if>
			<if test="RefPGID != null and RefPGID != ''">
				AND TP.RefPGID = #{RefPGID}
			</if>
			<if test="AuthorID != null and AuthorID != ''">
				AND TP.AuthorID = #{AuthorID}
			</if>
			<if test="RefPjtID != null and RefPjtID != ''">
				AND TP.RefPjtID = #{RefPjtID}
			</if>
			<if test="memberId != null and memberId != ''">
				AND TP.ProjectID in (Select ProjectID from XBOLTADM.TB_PJT_MEMBER_REL where MemberID = #{memberId})
			</if>
	</select>
	
	<select id="getParentPjtFromRel" resultType="java.util.HashMap">
  		SELECT Distinct 
  			PMR.ProjectID AS CODE
      		,TPT.Name As NAME
  		FROM 
  			XBOLTADM.TB_PJT_MEMBER_REL PMR,
  			XBOLTADM.TB_PROJECT TP
  			Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT
				on TP.ProjectID = TPT.ProjectID AND TPT.LanguageID = #{languageID}
  		WHERE 
  			PMR.ProjectID = TP.ProjectID
  			<choose>
				<when test="ProjectType != null and ProjectType != ''">
					AND RTRIM(TP.ProjectType) = #{ProjectType}
				</when>
				<otherwise>
					AND RTRIM(TP.ProjectType) = 'PJT'
				</otherwise>
  			</choose>
  			
  		    AND TP.Deactivated != 1
  		    AND #{loginUserId} IN (PMR.MemberID)
			<if test="openPJT != null and openPJT != ''">
				AND TP.Status != 'CLS' 
			</if>
			<if test="CsrCount != null and CsrCount != ''">
				AND (
					0 != (SELECT COUNT(ProjectID) FROM XBOLTADM.TB_PROJECT 
		  		  	WHERE ProjectType = 'CSR' AND Status != 'CLS' AND RefPjtID = TP.ProjectID)
				)
			</if>
			<if test="ProjectID != null and ProjectID != ''">
				AND TP.ProjectID = #{ProjectID} 
			</if>
			<if test="openSts != null and openSts != ''">
				AND TP.Status = #{openSts} 
			</if>
			<if test="refPGID != null and refPGID != ''">
				AND TP.RefPGID = #{refPGID} 
			</if>
			Order by NAME
	</select>
	
	<select id="getParentPjtOfCsr" resultType="java.util.HashMap">  
  		SELECT Distinct TP.RefPjtID As CODE
      		 ,TPT.Name As NAME
  		FROM XBOLTADM.TB_PROJECT TP
  		Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT
				on TP.RefPjtID = TPT.ProjectID AND TPT.LanguageID = #{languageID}
  		WHERE Deactivated != 1
  		   AND TP.ProjectID IN (${csrIds})
  		   <if test="csrStatus != null and csrStatus != ''">
  		   AND TP.Status = #{csrStatus}
  		   </if>  
  		   <if test="openCSR != null and openCSR != ''">	
  		   AND TP.Status Not In ('HOLD', 'CLS')	   
  		   </if>
	</select>
	
	<select id="getWFDescription" resultType="String">
  		SELECT 
      		Description
  		FROM XBOLTADM.TB_DICTIONARY
  		WHERE TypeCode = #{TypeCode} AND LanguageID = #{LanguageID}
	</select>
	
	<select id="getCsrStatusList" resultType="java.util.HashMap">
  		SELECT TypeCode, Name
      	FROM XBOLTADM.TB_DICTIONARY
  		WHERE Category = 'CSRSTS' AND LanguageID = #{LanguageID}
		<if test="TypeCode != null and TypeCode != ''">
			AND TypeCode IN (
				<foreach collection="TypeCode" index="index" item="item" separator=",">
					${item}
				</foreach>
			)
		</if>
		<if test="NotTypeCode != null and NotTypeCode != ''">
			AND TypeCode NOT IN (
				<foreach collection="NotTypeCode" index="index" item="item" separator=",">
					${item}
				</foreach>
			)
		</if>
  		ORDER BY SortNum	
	</select>
	
	<select id="getCurWfStepList" resultType="java.util.HashMap">
  		SELECT  
			Distinct TP.CurWFStepID AS TypeCode
			, WFSTEP.Name AS Name
		FROM 
			XBOLTADM.TB_PROJECT TP
			LEFT OUTER JOIN XBOLTADM.TB_DICTIONARY WFSTEP 
				ON WFSTEP.LanguageID = #{LanguageID} AND TP.CurWFStepID = WFSTEP.TypeCode
				AND WFSTEP.Category = 'WFSTEP'
		WHERE
			TP.ProjectType = 'CSR'
			AND TP.CurWFStepID IS NOT NULL
			<if test="TypeCode != null and TypeCode != ''">
				AND TP.Status IN (
					<foreach collection="TypeCode" index="index" item="item" separator=",">
						${item}
					</foreach>
				)
			</if>
			<if test="NotTypeCode != null and NotTypeCode != ''">
				AND TypeCode NOT IN (
					<foreach collection="NotTypeCode" index="index" item="item" separator=",">
						${item}
					</foreach>
				)
			</if>
	</select>
	
	<select id="getOwnerTeamList" resultType="java.util.HashMap">
		SELECT 
			DISTINCT
      		T1.OwnerTeamID AS TypeCode
      		,T2.Name  AS Name
  		FROM XBOLTADM.TB_PROJECT T1,
  			XBOLTADM.TB_TEAM_TXT T2
  		WHERE T1.OwnerTeamID = T2.TeamID
  			AND T1.ProjectType = 'CSR'
  			AND T2.LanguageID = #{LanguageID}
			<if test="TypeCode != null and TypeCode != ''">
				AND T1.Status IN (
					<foreach collection="TypeCode" index="index" item="item" separator=",">
						${item}
					</foreach>
				)
			</if>
	</select>
	
	
	<select id="getLastWFStepID" resultType="String">
  		SELECT TOP 1 
      		 WFStepID
  		FROM XBOLTADM.TB_WF_STEP_REL
  		WHERE WFID = #{WFID}
		order by SortNum DESC
	</select>
	
	<select id="getAllItemList_gridList" resultType="java.util.HashMap">
		SELECT 
			Top 300
			Row_Number()OVER(ORDER BY TI.Identifier ASC,  TIA.PlainText ASC ) as RNUM
			, 0 AS CHK
			, TI.ItemID
			, XBOLTADM.fn_GetMyAbsPathForList( TI.ItemID, #{languageID}  ) AS FatherName
			, TIA.PlainText as ItemName
			, TD.Name as ClassName
			, ISNULL(TT.Name, '') as TeamName
			, TOT.Name as OwnerTeamName	
			, TI.Identifier
			, TSD.Name AS StatusName
			, TI.AuthorID
			, TI.Status
			, TM.Name As AuthorName
			, ISNULL(CONVERT(char(10), TI.LastUpdated, 111),'-') as LastUpdated
		FROM
				XBOLTADM.TB_ITEM TI
				Left Outer Join XBOLTADM.TB_ITEM TIF on TI.ItemID = TIF.ToItemID AND TIF.CategoryCode = 'ST1'
				Left outer join XBOLTADM.TB_DICTIONARY TD on TI.ClassCode = TD.TypeCode AND TD.LanguageID = #{languageID}
				Left outer join XBOLTADM.TB_DICTIONARY TSD on TI.Status = TSD.TypeCode AND TSD.LanguageID = #{languageID} AND TSD.Category = 'ITMSTS'
				Left outer join XBOLTADM.TB_TEAM_TXT TT on TI.CompanyID = TT.TeamID AND TT.LanguageID  = #{languageID} 
				Left outer join XBOLTADM.TB_TEAM_TXT TOT on TI.OwnerTeamID = TOT.TeamID AND TOT.LanguageID  = #{languageID}
				Left outer join XBOLTADM.TB_ITEM_ATTR TIA on TI.ItemID = TIA.ItemID AND TIA.AttrTypeCode = 'AT00001' AND TIA.LanguageID  = #{languageID}
				Left outer join XBOLTADM.TB_MEMBER TM on TI.AuthorID = TM.MemberID
				Left Outer Join XBOLTADM.TB_ITEM_CLASS TCLS on TI.ClassCode = TCLS.ItemClassCode
		WHERE
			TI.ItemID NOT IN (SELECT ItemID FROM XBOLTADM.TB_CHANGE_SET WHERE ProjectID = #{ProjectID})
			<if test="ClassCode != null and ClassCode != ''">
				AND TI.ClassCode = #{ClassCode}
			</if>
			<if test="ItemTypeCode != null and ItemTypeCode != ''">
				AND TI.ItemTypeCode = #{ItemTypeCode}
			</if>
			<if test="AuthorID != null and AuthorID != ''">
				AND TI.AuthorID = #{AuthorID}
			</if>
			<if test="searchValue != null and searchValue != ''">
				<choose>
					<when test="searchKey.equals('Name')">
						AND TIA.PlainText like N'%'+#{searchValue}+'%'
					</when>
					<when test="searchKey.equals('Code')">
						AND TI.Identifier like N'%'+#{searchValue}+'%'
					</when>
					<when test="searchKey.equals('Info')">
						AND TIA.PlainText like N'%'+#{searchValue}+'%'
					</when>
				</choose>
			</if>
			<if test="newCompanyCode != null and newCompanyCode != ''">
				AND TT.TeamID = #{newCompanyCode}
			</if>
			<if test="Status.size > 0">
				AND TI.Status IN 
							<foreach collection="Status" index="index" item="item" open="(" close=")"  separator=",">
								${item}
							</foreach>
			</if>
			<if test="ChangeMgt != null and ChangeMgt != ''">
				AND TCLS.ChangeMgt = #{ChangeMgt}
			</if>
			order by
				TI.Identifier ASC, TIA.PlainText ASC
	</select>
 	
 	<insert id="insertToWfStepInst" parameterType="java.util.HashMap">
 		INSERT INTO
 			XBOLTADM.TB_WF_STEP_INST(
 			StepInstID
 			, ChangeSetID
      		, WFID
      		, WFStepID
      		, ActorID
      		, ActorTeamID
      		, Event
      		, CreationTime
      		, LastUpdated
 		)VALUES(
			#{StepInstID}
			, #{ChangeSetID}
			, #{WFID}
			, #{WFStepID}
			, #{ActorID}
			, (SELECT TeamID FROM XBOLTADM.TB_MEMBER WHERE MemberID = #{ActorID}) 
			, #{Event}
			, getdate()
			, getdate()
		)
 	</insert>
 	
 	
 	<insert id="insertToChangeSetStep" parameterType="java.util.HashMap">
 		INSERT INTO
 			XBOLTADM.TB_SAP_DEV(
 			ChangeSetID
           , ItemID
           , InChargeUser
           , ProgramStatus
           , PlannedStartDate
           , PlannedEndDate
           , ActualStartDate
           , ActualEndDate
           , Status
           , UTScenarioStatus
           , IfMappingName
      	   , LegacyPlannedEndDate
           , LegacyActualEndDate
           , EAIEndDate
           , MWUtEndDate
      	   , Creator
           , CreationTime
           , LastUser
           , LastUpdated
           )
		VALUES(
			#{ChangeSetID}
			, #{ItemID}
			, #{InChargeUser}
			, #{ProgramStatus}
			, #{PlannedStartDate}
			, #{PlannedEndDate}
			, #{ActualStartDate}
			, #{ActualEndDate}
			, #{Status}
			, #{UTScenarioStatus}
			, #{IfMappingName}
      	    , #{LegacyPlannedEndDate}
            , #{LegacyActualEndDate}
            , #{EAIEndDate}
            , #{MWUtEndDate}
			, #{Creator}
			, getdate()
			, #{LastUser}
			, getdate()
		)
 	</insert>
 	
 	<update id="updateChangeSetStep" parameterType="java.util.HashMap">
 		UPDATE	XBOLTADM.TB_SAP_DEV
 		SET
 			InChargeUser = #{InChargeUser}
 			, PlannedStartDate = #{PlannedStartDate}
 			, PlannedEndDate = #{PlannedEndDate}
 			, ActualStartDate = #{ActualStartDate}
 			, ActualEndDate = #{ActualEndDate}
 			, Status = #{Status}
 			, UTScenarioStatus = #{UTScenarioStatus}
 			, IfMappingName = #{IfMappingName}
      	   	, LegacyPlannedEndDate = #{LegacyPlannedEndDate}
           	, LegacyActualEndDate = #{LegacyActualEndDate}
           	, EAIEndDate = #{EAIEndDate}
           	, MWUtEndDate = #{MWUtEndDate}
 			, LastUser = #{userId}
      		, LastUpdated  = getDate()
 			
 		WHERE
 			ItemID = #{s_itemID}
 			AND ChangeSetID = #{ChangeSetID}
 			AND ProgramStatus = #{ProgramStatus}
 	</update>
 	
 	<update id="updateItemStatus" parameterType="java.util.HashMap">
		UPDATE 
			XBOLTADM.TB_ITEM
		SET
			LastUpdated = getDate()			
			<if test="Status != null and Status != ''">
				<choose>					
					<when test="recover != null and recover != ''">
						, Status = Case When Status = 'DEL1' Then 'MOD1' 
							  		    When Status = 'NEW1' Then 'NEW1'
						 			    Else #{Status} END
					</when>		
					<when test="rework != null and rework != ''">
						, Status = Case When Status = 'MOD2' Then 'MOD1' 
							  		    When Status = 'NEW2' Then 'NEW1'
							  		    When Status = 'DEL2' Then 'MOD1'
						 			    Else #{Status} END
					</when>
					<otherwise>
						, Status = #{Status}
					</otherwise>	
				</choose>
			</if>		
			<if test="ReleaseNo != null and ReleaseNo != ''">
				, ReleaseNo = #{ReleaseNo}
			</if>
			<if test="LastUser != null and LastUser != ''">
				, LastUser = #{LastUser}
			</if>
			<if test="Blocked != null and Blocked != ''">
				, Blocked = #{Blocked}
			</if>
			<if test="Deleted != null and Deleted != ''">
				, Deleted = #{Deleted}
			</if>
			<if test="Identifier != null and Identifier != ''">
				, Identifier = #{Identifier}
			</if>
			<if test="ProjectID != null and ProjectID != ''">
				, ProjectID = #{ProjectID}
			</if>
			<if test="CurChangeSet != null and CurChangeSet != ''">
				, CurChangeSet = #{CurChangeSet}
			</if>			
			<if test="AuthorID != null and AuthorID != ''">
				, AuthorID = #{AuthorID}
			</if>
			<if test="OwnerTeamID != null and OwnerTeamID != ''">
				, OwnerTeamID = #{OwnerTeamID}
			</if>
		<where>
			<if test="s_itemID != null and s_itemID != ''">
				ItemID = #{s_itemID}
			</if>
			<if test="s_itemIDs != null and s_itemIDs != ''">
				AND ItemID IN (${s_itemIDs})
			</if>
			<if test="curChangeSet != null and curChangeSet != ''">
				AND CurChangeSet = #{curChangeSet}
			</if>			
		</where>		
	</update>
	
	 
 	<select id="getMemberInfoList" resultType="java.util.HashMap">
 		SELECT 
 			Name + '(' + LoginID + ')' As MemberInfo
      	FROM XBOLTADM.TB_MEMBER
  		WHERE MemberID IN (${memberIds})
 	</select>
 	
 	<select id="pjtFile_nextVal" resultType="String">
		SELECT ISNULL(MAX(Seq)+1,'1') AS FILEID_NEXTVAL FROM XBOLTADM.TB_PJT_FILE
	</select>
	
	<insert id="pjtFile_insert"  parameterType="java.util.HashMap">
			INSERT INTO XBOLTADM.TB_PJT_FILE (
				Seq
				,ProjectID	
				,FileName
				,FileRealName
				,FileSize
				,FileMgt
				,RegMemberID
				,CreationTime
				,LastUpdated
				,LastUser
				,DownCNT
				,LanguageID
			)
			VALUES (
				#{Seq}
				, #{ProjectID}
				, #{FileName}
				, #{FileRealName}
				, #{FileSize}
				, #{FileMgt}
				, #{userId}
				, getDate()
				, getDate()
				, #{userId}
				, 0
				, #{LanguageID}
			)
	</insert>
	
	<select id="getProjectFileList" resultType="java.util.HashMap">
		SELECT
		   pjtfl.Seq
		  ,pjtfl.ProjectID
		  ,pjtfl.FileName
		  ,pjtfl.FileFormat
		  ,pjtfl.FileRealName
		  ,pjtfl.FileSize
		  ,pjtfl.FileMgt
		  ,pjtfl.RegMemberID
		  ,CONVERT(CHAR(10),CONVERT(datetime,pjtfl.CreationTime),21) as CreationTime
		  ,CONVERT(CHAR(10),CONVERT(datetime,pjtfl.LastUpdated),21) as LastUpdated
		  ,pjtfl.LastUser
		  ,pjtfl.Version
		  ,pjtfl.DownCNT
		FROM XBOLTADM.TB_PJT_FILE pjtfl
		<where>
			<if test="ProjectID != null and ProjectID != ''">
				ProjectID = #{ProjectID}
			</if>
		</where>
 	</select>
 	
 	<select id="getPjtFileList" resultType="java.util.HashMap">
		SELECT
		   Seq
		  ,ProjectID
		  ,FileName
		  ,FileFormat
		  ,FileRealName
		  ,FileSize
		  ,FileMgt
		  ,RegMemberID
		  ,CONVERT(CHAR(10),CONVERT(datetime,CreationTime),21) as CreationTime
		  ,CONVERT(CHAR(10),CONVERT(datetime,LastUpdated),21) as LastUpdated
		  ,LastUser
		  ,Version
		  ,DownCNT
		FROM XBOLTADM.TB_FILE 
		<where>
			<if test="ProjectID != null and ProjectID != ''">
				ProjectID = #{ProjectID}
			</if>
			<if test="itemID == null or (itemID != null and itemID.equals('null'))">
				AND DocumentID Is Null
			</if>
		</where>
 	</select>
 	
 	<select id="selectDownFile" resultType="java.util.HashMap">
		SELECT  FileName as filename
				, FileRealName as original
				, #{FilePath} + FileName as downFile
		FROM XBOLTADM.TB_FILE
		WHERE Seq = #{Seq}
	</select>
	
	<select id="getPjtMemberRelCnt" resultType="String">
		SELECT
			COUNT(MemberID) As cnt
		FROM
			XBOLTADM.TB_PJT_MEMBER_REL
		WHERE
			ProjectID = #{ProjectID} AND MemberID = #{MemberID}
	</select> 
	
	<delete id="delProjectFile" parameterType="java.util.HashMap">
	  	Delete FROM XBOLTADM.TB_PJT_FILE
	  	WHERE ProjectID = #{ProjectID} AND Seq = #{Seq}
	 </delete>
	 
	 <delete id="delPjtFile" parameterType="java.util.HashMap">
	  	Delete FROM XBOLTADM.TB_FILE
	  	WHERE ProjectID = #{ProjectID} AND Seq = #{Seq}
	 </delete>
	 
	 <select id="getChangeMgt" resultType="String">
		SELECT 
      		ISNULL(ChangeMgt, '') As ChangeMgt
      	FROM XBOLTADM.TB_ITEM_CLASS
  			WHERE ItemClassCode = (SELECT ClassCode FROM XBOLTADM.TB_ITEM WHERE ItemID = #{ItemID})
	 </select> 	
	 
	 
	 <select id="getItemProjectId" resultType="String">
		SELECT 
      		ISNULL(ProjectID, '') As ProjectID
      	FROM XBOLTADM.TB_ITEM
  			WHERE ItemID = #{ItemID}
	 </select> 	
	 
	 <select id="getProjectCreatorCnt" resultType="String">
		SELECT 
      		COUNT(Creator) AS CNT
      	FROM 
  			XBOLTADM.TB_PROJECT
  		WHERE 
 			ProjectID = #{ProjectID}
      		AND Creator = #{AuthorID}
	 </select> 
	 
	 <select id="getProjectMemberCnt" resultType="String">
		SELECT 
      		COUNT(MemberID) AS CNT
      	FROM 
  			XBOLTADM.TB_PJT_MEMBER_REL
  		WHERE 
 			ProjectID = #{ProjectID}
      		AND MemberID = #{AuthorID}
	 </select>
	 
	 <select id="getProjectMemberList" resultType="java.util.HashMap">
	  	SELECT Distinct T2.MemberID
      		  , T2.Name
      	FROM XBOLTADM.TB_PJT_MEMBER_REL T1,
	  		 XBOLTADM.TB_MEMBER T2
	  	WHERE (ProjectID = #{s_itemID} AND T1.MemberID = T2.MemberID)
	  	or  T2.MemberID = #{Creator}
	 </select>	
	 
	 <select id="getVarItemList" resultType="java.util.HashMap">
	 	SELECT ItemID
	 	FROM XBOLTADM.TB_ITEM
	 	WHERE RefItemID = #{s_itemID} AND ProjectID = #{ProjectID}
	 </select>
	 

	<update id="updatePjtMemberRel" parameterType="java.util.HashMap">
 		UPDATE	XBOLTADM.TB_PJT_MEMBER_REL
 		SET Involved = #{Involved} 
		<if test="DropOutDate != null and DropOutDate != ''">
			,DropOutDate = getDate()
		</if>	 		
 		<where>	 		
			<if test="ProjectID != null and ProjectID != ''">
				ProjectID = #{ProjectID}
			</if>
		</where>
 	</update>
 	
 	<select id="getDictionaryName" resultType="String">
 		SELECT 
      		Name
  		FROM XBOLTADM.TB_DICTIONARY
  		where Category = #{Category} 
  			AND LanguageID = #{languageID}
  			AND TypeCode = #{TypeCode}
 	</select>
 	
 	<select id="getPjtRelTeam" resultType="java.util.HashMap">
 		SELECT Distinct
	      	T2.TeamID As CODE
	      	, T3.Name As NAME
		  FROM XBOLTADM.TB_PJT_MEMBER_REL T1
		  Left outer join XBOLTADM.TB_MEMBER T2 on T1.MemberID = T2.MemberID
		  Left outer join XBOLTADM.TB_TEAM_TXT T3 on T2.TeamID = T3.TeamID AND T3.LanguageID  = #{sessionCurrLangType}
		  where T1.ProjectID = #{projectID}
 	</select>
 	
 	<select id="checkPjtCodeUnique" resultType="String">
 		SELECT 
      		Count(ProjectID)
  		FROM XBOLTADM.TB_PROJECT
  		<where>
			<if test="ProjectType != null and ProjectType != ''">	
			ProjectType = #{ProjectType}
				<if test="ProjectID != null and ProjectID != ''">	
					AND ProjectID != #{ProjectID}
				</if> 
			</if> 
			<if test="Prefix != null and Prefix != ''">	
			AND Prefix = #{Prefix}
				<if test="ProjectID != null and ProjectID != ''">	
					AND ProjectID != #{ProjectID}
				</if> 
			</if> 
			<if test="ProjectCode != null and ProjectCode != ''">	
			AND ProjectCode = #{ProjectCode}
			</if> 
			<if test="ParentID != null and ParentID != ''">	
			AND RefPjtID = #{ParentID}
			</if> 
			<if test="StatusCheck != null and StatusCheck != ''">	
			AND Status != #{StatusCheck}
			</if> 
  		</where>
 	</select>
 	
 	<update id="updateClsPjtItems" parameterType="java.util.HashMap">
 		UPDATE	XBOLTADM.TB_ITEM
 		SET
 			LastUpdated  = getDate()
 			, LastUser = #{LastUser}
 			, Status = 'REL'
 		WHERE
 			ProjectID = #{ProjectID}
 			AND 0 = (SELECT ChangeMgt FROM XBOLTADM.TB_ITEM_CLASS WHERE ItemClassCode = ClassCode)
 			AND Status = 'NEW1'
 	</update>
 	
 	
 	<select id="getPjtTaskTypeList_gridList" resultType="java.util.HashMap">
 		Select 
 			Row_Number()OVER(ORDER BY  PJTSK.TaskTypeCode ASC) as RNUM,
			PJTSK.TaskTypeCode,
			TD.Name TaskTypeName,
			PJTSK.ItemClassCode,
			TD2.Name As ItemClass,
			PJTSK.ProjectID,
			TPT.Name As ProjectName,
			PJTSK.SortNum,
			( Select count(T1.TaskTypeCode) From XBOLTADM.TB_PJT_TASK_TP T1
				Left Outer Join XBOLTADM.TB_PROJECT T2 ON T1.ProjectID = T2.ProjectID
				Where T2.RefPjtID = #{projectID} And T1.TaskTypeCode = PJTSK.TaskTypeCode
			) As PjtTaskCnt,
			PJTSK.SortNum,
			PJTSK.Mandatory
		From XBOLTADM.TB_PJT_TASK_TP PJTSK
		Left Outer Join XBOLTADM.TB_DICTIONARY TD ON TD.TypeCode = PJTSK.TaskTypeCode And TD.LanguageID = #{languageID}
		Left Outer Join XBOLTADM.TB_DICTIONARY TD2 ON TD2.TypeCode = PJTSK.ItemClassCode And TD2.LanguageID = #{languageID}
		Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT ON TPT.ProjectID = PJTSK.ProjectID And TPT.LanguageID = #{languageID}
		Where PJTSK.ProjectID = #{projectID}
		<if test="searchValue != null and searchValue != ''">
			<choose>
				<when test="searchKey.equals('name')">
					AND TD.Name like N'%'+#{searchValue}+'%'
				</when>
				<when test="searchKey.equals('code')">
					AND PJTSK.TaskTypeCode like N'%'+#{searchValue}+'%'
				</when>
			</choose>
		</if>
 	</select>
 	
 	<select id="getTaskTypeForPjtList_gridList" resultType="java.util.HashMap">
 		Select
 			Row_Number()OVER(ORDER BY  TSKT.TaskTypeCode ASC) as RNUM, 
 			TSKT.TaskTypeCode,
			TD.Name As TaskTypeName,
			TSKT.ItemClassCode,
			TD2.Name As ItemClass	 
		From XBOLTADM.TB_TASK_TYPE TSKT
		Left Outer Join XBOLTADM.TB_DICTIONARY TD ON TD.TypeCode = TSKT.TaskTypeCode And TD.LanguageID = #{languageID}
		Left Outer Join XBOLTADM.TB_DICTIONARY TD2 ON TD2.TypeCode = TSKT.ItemClassCode And TD2.LanguageID = #{languageID}
		Where TaskTypeCode Not In (Select TaskTypeCode From XBOLTADM.TB_PJT_TASK_TP Where ProjectID = #{projectID}) 
 	</select>
 	
 	<insert id="insertPjtTaskTypeCode" parameterType="java.util.HashMap">
 		Insert Into XBOLTADM.TB_PJT_TASK_TP (ProjectID, TaskTypeCode, ItemClassCode, Deactivated, CreationTime, Creator, SortNum)
			Values(#{projectID}, #{taskTypeCode}, #{itemClassCode}, 0, GetDate(), #{userID}, #{sortNum})
 	</insert>
 	
 	<select id="getMaxTaskTypeSortNum" resultType="String">
 		Select ISNULL(Cast(Max(SortNum)+1 AS CHAR(10)), 1) As SortNum From XBOLTADM.TB_PJT_TASK_TP Where ProjectID = #{projectID}
 	</select>
 	
 	<delete id="deletePjtTaskTypeCode" parameterType="java.util.HashMap">
 		Delete From XBOLTADM.TB_PJT_TASK_TP Where ProjectID = #{projectID} And TaskTypeCode = #{taskTypeCode}
 	</delete>
 	
 	<update id="udpatePjtTaskTypeInfo" parameterType="java.util.HashMap">
 		Update XBOLTADM.TB_PJT_TASK_TP Set
		 SortNum = #{sortNum}, 
		 Mandatory = #{mandatory},
		 LastUpdate = GETDATE(),
		 LastUser = #{userID} 
		Where ProjectID = #{projectID}
		And TaskTypeCode = #{taskTypeCode}	
 	</update>
 	
 	<select id="getMyItemForMyPage" resultType="java.util.HashMap">
 		SELECT
 			Row_Number()OVER(ORDER BY ItemTypeCode, Path) as RNUM 
			, 0 AS CHK
			, ItemTypeImg 
			, ItemTypeCode
			, ItemTypeName
			, ClassCode
			, ClassName
			, Path
			, ItemID
			, Identifier
			, ItemName
			, PjtName
			, CsrName
			, OwnerTeamName
			, LastUpdated
			, Status
			, StatusName 
		FROM (
			SELECT 
				DISTINCT
				TI.ItemID
				, TIT.ItemTypeCode
				, TITN.Name As ItemTypeName
				, ISNULL(TIT.Icon, 'img_job.png') ItemTypeImg
				, TD.Name as ClassName, TI.ClassCode
			   	, ISNULL(PITM.Identifier,'') + ' ' + ISNULL(XBOLTADM.fn_GetMyAbsPathForList( TI.ItemID ,#{sessionCurrLangType}),'')  AS Path   
				, ISNULL(TIA.PlainText,'') as ItemName
				, TPT2.Name As PjtName
				, TPT1.Name As CsrName
				, TOT.Name as OwnerTeamName
				, TI.Version, TI.Identifier
				, TI.Status
				, TSD.Name AS StatusName
				, Convert(nvarchar(20),TI.LastUpdated, 111) AS LastUpdated
				
			FROM
				XBOLTADM.TB_ITEM TI
				Left Outer JOIN XBOLTADM.TB_ITEM_TYPE TIT ON TI.ItemTypeCode = TIT.ItemTypeCode
				Left Outer JOIN XBOLTADM.TB_ITEM_CLASS TIC ON TI.ClassCode = TIC.ItemClassCode
				Left Outer JOIN XBOLTADM.TB_PROJECT TP1 ON TI.ProjectID = TP1.ProjectID
				Left Outer JOIN XBOLTADM.TB_PROJECT_TXT TPT1 ON TI.ProjectID = TPT1.ProjectID AND TPT1.LanguageID = #{sessionCurrLangType}
				Left Outer JOIN XBOLTADM.TB_PROJECT_TXT TPT2 ON TP1.RefPjtID = TPT2.ProjectID AND TPT2.LanguageID = #{sessionCurrLangType}
				Left outer join XBOLTADM.TB_DICTIONARY TD on TI.ClassCode = TD.TypeCode AND TD.LanguageID = #{sessionCurrLangType}
				Left outer join XBOLTADM.TB_DICTIONARY TITN on TI.ItemTypeCode = TITN.TypeCode AND TITN.LanguageID = #{sessionCurrLangType}
				Left outer join XBOLTADM.TB_DICTIONARY TSD on TI.Status = TSD.TypeCode AND TSD.LanguageID = #{sessionCurrLangType} AND TSD.Category = 'ITMSTS'
				Left outer join XBOLTADM.TB_TEAM_TXT TOT on TI.OwnerTeamID = TOT.TeamID AND TOT.LanguageID = #{sessionCurrLangType}
				Left outer join XBOLTADM.TB_ITEM_ATTR TIA on TI.ItemID = TIA.ItemID AND TIA.AttrTypeCode = 'AT00001'  AND TIA.LanguageID = #{sessionCurrLangType}
				Left Outer JOIN XBOLTADM.TB_ITEM ST1 ON TI.ItemID = ST1.ToItemID and ST1.CategoryCode = 'ST1'
				Left Outer JOIN XBOLTADM.TB_ITEM PITM ON ST1.FromItemID = PITM.ItemID 
	
			WHERE
				TIC.ChangeMgt = 1
				AND TI.AuthorID = #{sessionAuthId}
				<if test="ClassCode != null and ClassCode != ''">
					AND TI.ClassCode = #{ClassCode}
				</if>
				<if test="Status != null and Status != ''">
					AND TI.Status = #{Status}
				</if>	
		) A	
		GROUP BY 
			ItemTypeCode
			, ItemTypeName
			, ItemTypeImg
			, ClassName, ClassCode
			, Path
			, ItemID
			, Identifier
			, ItemName
			, PjtName
			, CsrName 
			, OwnerTeamName
			, LastUpdated
			, Status
			, StatusName 
		Order By ItemTypeCode, Path
 		
 	</select>
 	
 	<select id="getRefPjtID" resultType="String">
 		Select RefPjtID From XBOLTADM.TB_PROJECT Where ProjectID = #{projectID}
 	</select>
 	
	<select id="getMaxCSRCode" resultType="String">
  		SELECT
      		TOP 1 ProjectCode
  		FROM XBOLTADM.TB_PROJECT
  		Where subString(ProjectCode, 4,6) = #{thisYmd} AND RTRIM(ProjectType) = 'CSR' order by ProjectID DESC
	</select>
	
 	<select id="getCRCount" resultType="String">
 		Select Count(*) As CRCount  from XBOLTADM.TB_CR_MST
 		Where CSRID = #{csrID} 
 		<if test="Status != null and Status != ''">
	 		<choose>
				<when test="Status.equals('ING')">
					AND Status != 'CLS' AND Status != 'WTR'
				</when>
				<otherwise>	
					AND Status = #{Status}
				</otherwise>
			</choose>	
		</if>
 	</select>
 	
 	<update id="updateCSRStatus" parameterType="java.util.HashMap">
 		Update XBOLTADM.TB_PROJECT Set 
 			Status = #{status},
 			LastUpdated = GETDATE() ,	
 			<choose>
				<when test="status != null and status.equals('CLS')">
					EndDate = GETDATE()
				</when>
				<otherwise>	
					EndDate = Null
				</otherwise>
 			</choose>	 					
 		Where ProjectID = #{csrID}
 	</update>
 	
 	<select id="getCsrCountFromSR" resultType="String">
 		Select COUNT(*) As CsrCountFromSR From XBOLTADM.TB_PROJECT 
		Where SRID = #{srID} And ProjectID != #{csrID} And Status Not In ('CLS', 'WTR')
	</select>
	
	<update id="updateItemStatusFromCSR" parameterType="java.util.HashMap">
		 Update XBOLTADM.TB_ITEM Set
		 	Status  = #{status},
		 	LastUser = #{lastUser},
 			LastUpdated = GETDATE()
		 Where ItemID IN(Select ItemID From XBOLTADM.TB_CHANGE_SET Where ProjectID = #{csrID})
	</update>
		
	<select id="getCsrCntSR" resultType="String">
		Select Count(*) As CSRCnt From XBOLTADM.TB_PROJECT 
		Where ProjectType = 'CSR' 
		And SRID= #{srID} 
		And <![CDATA[ Convert(varchar(10),DueDate, 120) > #{DueDate} ]]>
	</select>
	
	<update id="updateItemDeletedFromCS" parameterType="java.util.HashMap">
		Update XBOLTADM.TB_ITEM Set 
  		Deleted = #{deleted}
		where ItemID = #{itemID} 
				or 
			  ItemID IN ( Select ToItemID From XBOLTADM.TB_ITEM Where CategoryCode = 'ST1' And FromItemID = #{itemID}  )
				or
			  #{itemID} in ( FromItemID, ToItemID) 
	</update>  	
  	
  	<select id="getBasModelInfo" resultType="java.util.HashMap">
  		Select TOP 1 TM.ModelID, TMT.Name As ModelName 
		From XBOLTADM.TB_MODEL TM 
		Left Outer Join XBOLTADM.TB_MODEL_TXT TMT ON TMT.ModelID = TM.ModelID And TMT.LanguageID = #{languageID}
		Where TM.ItemID = #{itemID} 
  			<if test="mtCategory != null and mtCategory != ''" >
  				And MTCategory = #{mtCategory}
  			</if>
  			
		ORDER BY TM.ModelID
  	</select>
  	
  	<update id="updateModel" parameterType="java.util.HashMap">
  		Update XBOLTADM.TB_MODEL 
  			<if test="blocked != null and blocked != ''" ><trim prefix="SET" suffixOverrides=","> Blocked = #{blocked}</trim></if>
  		Where modelID = #{modelID} 
  		And MTCategory = #{MTCategory}
  	</update>
  	
  	<select id="getTeamPath" resultType="String">  		
  		SELECT 
			XBOLTADM.fn_GetMyAbsPathForOrg(TM.TeamID , #{languageID}) + '/' + TTT.Name AS TeamPath
		FROM
			XBOLTADM.TB_MEMBER TM
			Left Outer Join XBOLTADM.TB_TEAM_TXT TTT On TM.TeamID = TTT.TeamID  AND TTT.LanguageID = #{languageID}
		WHERE TM.MemberID = #{userID}
  	</select>
  	
	<select id="getMyItemFromSRList" resultType="java.util.HashMap">
		Select TMI.MemberID, TMI.ItemID, TMI.RoleType,
				TM.Name AS MemberName, TMT.Name As TeamName
		From XBOLTADM.TB_MY_ITEM TMI
		 Left Outer Join XBOLTADM.TB_MEMBER TM ON TM.MemberID = TMI.MemberID 
		 Left Outer Join XBOLTADM.TB_TEAM_TXT TMT ON TMT.TeamID = TM.TeamID And TMT.LanguageID = #{languageID}
		<where>
			<if test="srID != null and srID != ''">
				ItemID = ( Select SRArea2 From XBOLTAPP.ESM_SR_MST Where SRID = #{srID} )
			</if>
			 And AssignmentType = 'WFSTEP'
		</where>
		 Order By OrderNum
	</select>
	<select id="getCSRNotWTRCnt" resultType="String" >
		Select COUNT(*) From XBOLTADM.TB_PROJECT
		Where SRID = #{srID}
		And Status != 'WTR'
	</select>
	
	<select id="getEvaluationClassInfo" resultType="java.util.HashMap">
		Select ISNULL(TIC.RefClass,'') AS EvaluationClass,
			TIC2.ItemTypeCode EVType,
			TD.Name AS EvaluationClassName
		From XBOLTADM.TB_ITEM_CLASS TIC
		Left Outer Join XBOLTADM.TB_ITEM_CLASS TIC2 ON TIC2.ItemClassCode = TIC.RefClass
		Left Outer Join XBOLTADM.TB_DICTIONARY TD ON TIC.RefClass = TD.TypeCode And TD.LanguageID = #{languageID} And Category = 'CLS'
		Where TIC.ItemClassCode = (Select ClassCode From XBOLTADM.TB_ITEM Where ItemID = #{itemID})
	</select>
	
	<select id="getEvaluationList" resultType="java.util.HashMap">
		Select
			TATA.AttrTypeCode
			, TD.Name As AttrTypeName
			,CASE TAT.DataType
				WHEN 'LOV' THEN TATL.Value
				ELSE ISNULL(TIA.PlainText, '') 
			  END PlainText	
			, ISNULL(TIA.LovCode, '') AS LovCode
			, ISNULL(TATL.AttrTypeCode, '') AS BaseLovCode
			, TAT.DataType
			, TAT.IsComLang
			, TAT.HTML
			, ISNULL(TATA.Mandatory, '') AS Mandatory
			, TES.Seq AS EVSeq
			, CAST(ISNULL(TES.Score,3) AS Int) AS EVScore
			, TES.Value AS EVValue
			, TEM.EvaluationID
		From XBOLTADM.TB_ATTR_TYPE_ALLOCATION TATA
		Left Outer Join XBOLTADM.TB_DICTIONARY TD ON TD.TypeCode = TATA.AttrTypeCode And TD.LanguageID = #{languageID}
		Left Outer Join XBOLTADM.TB_ITEM_ATTR TIA ON TIA.AttrTypeCode= TATA.AttrTypeCode And TIA.ItemID = #{itemID} And TIA.LanguageID = #{languageID}
		Left Outer Join XBOLTADM.TB_ATTR_TYPE TAT ON TAT.AttrTypeCode = TATA.AttrTypeCode 
		Left Outer Join	XBOLTADM.TB_ATTR_TYPE_LOV TATL ON TATA.AttrTypeCode = TATL.AttrTypeCode AND TIA.LovCode = TATL.LovCode AND TATL.LanguageID = #{languageID}
		Left Outer Join XBOLTADM.TB_EV_MST TEM ON TEM.EVClass = TATA.ItemClassCode 
												And TEM.ObjectID = #{itemID} And TEM.EvaluatorID =  #{userID} 
												And ProjectID = #{projectID} AND ChangeSetID = #{changeSetID}
		Left Outer Join XBOLTADM.TB_EV_SCORE TES ON TES.EvaluationID = TEM.EvaluationID  And TES.EVUnitCode = TATA.AttrTypeCode 
		Where TATA.ItemClassCode = #{evaluationClassCode}
	</select>
	
	<select id="getMaxEVSeqID" resultType="String">
  		SELECT ISNULL(MAX(Seq), 0)+1 AS MAXID
      	FROM XBOLTADM.TB_EV_SCORE
	</select>
	
	<select id="getMaxEvaluationID" resultType="String">
  		SELECT ISNULL(MAX(EvaluationID), 0)+1 AS MAXID FROM XBOLTADM.TB_EV_MST
	</select>	
	
	<insert id="insertEVMST" parameterType="java.util.HashMap">
		Insert Into XBOLTADM.TB_EV_MST
		  ( EvaluationID
		  	, EVType 
		  	, EVClass
		  	, ObjectID
		  	, ProjectID
			<if test="changeSetID != null and changeSetID != ''">
				, ChangeSetID
			</if>
		  	, EvaluatorID
		  	, TeamID
		  	, CreationTime
		  	, LastUpdated 		  
		)Values(
			#{evaluationID}
			, #{evType}
			, #{evClass}
			, #{objectID}
			, #{projectID}
			<if test="changeSetID != null and changeSetID != ''">
				, #{changeSetID}
			</if>		
			, #{evaluatorID}
			, #{teamID}
			, GETDATE()
			, GETDATE()
		)
	</insert>
	
	<insert id="insertEVScore" parameterType="java.util.HashMap">
		Insert Into XBOLTADM.TB_EV_SCORE
		  ( Seq
			, EvaluationID
			, EVUnitCode
			, Value 
			<if test="lovCode != null and lovCode != ''">
				, LovCode 
			</if>	
			, Score 			
			, CreationTime
			, LastUpdated )
		Values(
			#{evSeq}
			, #{evaluationID}
			, #{evUnitCode}
			, #{evValue}
			<if test="lovCode != null and lovCode != ''">
				, #{lovCode}
			</if>	
			, #{evScore}
			, GETDATE()
			, GETDATE()
		)
	</insert>
	
	<update id="updateEVScore" parameterType="java.util.HashMap" >
		Update XBOLTADM.TB_EV_SCORE SET
			Value = #{evValue},
			Score = #{evScore},
			LovCode = #{lovCode}, 
			LastUpdated = GETDATE()
		Where Seq = #{evSeq}	
	</update>
	
	<select id="getEvaluationID" resultType="String" >
		Select EvaluationID 
		From XBOLTADM.TB_EV_MST
		Where EVType = #{evType}
		And EVClass = #{evClass}
		And ObjectID = #{objectID}
		And EvaluatorID = #{userID}
		AND ProjectID = #{projectID}
		And ChangeSetID = #{changeSetID}
	</select>
	
	<select id="getPJTMemberRelList_gridList" resultType="java.util.HashMap">
		Select 
			Row_Number()OVER(ORDER BY  TPT.Name) as RNUM, 
			TP.ProjectCode,
			TPMR.ProjectID,
			TPT.Name ProjectName,
			TP.TemplCode,
			TP.ProjectType,
			TM.URL AS TemplUrl,
			TD.Name AS TemplName,
			ISNULL(TM.VarFilter,'') AS URLFilter,
			ISNULL(TMPL.VarFilter,'') AS TmplFilter,
			TD1.Name As StatusNM
		From XBOLTADM.TB_PJT_MEMBER_REL TPMR,
		XBOLTADM.TB_PROJECT TP
		Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT ON TPT.ProjectID = TP.ProjectID And TPT.LanguageID = #{languageID}
		Left Outer Join XBOLTADM.TB_TEMPL TMPL ON TMPL.TemplCode = TP.TemplCode 
		Left Outer Join XBOLTADM.TB_MENU TM ON TM.MenuID = TMPL.MenuID 
		Left Outer Join XBOLTADM.TB_DICTIONARY TD ON TD.TypeCode = TMPL.TemplCode And TD.LanguageID = #{languageID}
		Left Outer Join XBOLTADM.TB_DICTIONARY TD1 ON TD1.TypeCode = TP.Status  And TD1.LanguageID = #{languageID} And TD1.Category = 'PJTSTS'
	   
	    Where TPMR.ProjectID = TP.ProjectID
		 AND TPMR.MemberID = #{loginUserID}
		 And TP.Deactivated != 1
		 And TP.ProjectType = 'PJT'
	 </select>
	 
	<select id="getProjectName" resultType="String">
  		Select Name As ProjectName From XBOLTADM.TB_PROJECT_TXT TPT Where ProjectID = #{projectID} And LanguageID = #{languageID}
	</select>
	
	<select id="getProjectID" resultType="String">
  		Select ProjectID From XBOLTADM.TB_PROJECT Where ProjectCode = #{projectCode}
	</select>
	
	<!-- And ISNULL(TIC.ChangeMgt,'') != '1' -->
	<select id="getChangeMgtCsrIDList" resultType="java.util.HashMap">
		Select TI.ItemID From XBOLTADM.TB_ITEM TI
		Left Outer Join XBOLTADM.TB_ITEM_CLASS TIC ON TIC.ItemClassCode = TI.ClassCode 
		Where TI.ProjectID = #{csrID}
	</select>
	
	<select id="getPjtAuthorID" resultType="String">
  		Select AuthorID From XBOLTADM.TB_PROJECT Where ProjectID = #{ProjectID} 
	</select>
	
	<select id="getPjtAprvOption" resultType="String">
  		Select AprvOption From XBOLTADM.TB_PROJECT Where ProjectID = #{ProjectID} 
	</select>
	
	
	<insert id="insertItemAttrRev" parameterType="java.util.HashMap">
		Insert Into XBOLTADM.TB_ITEM_ATTR_REV(
			ChangeSetID,
			Seq,
			ItemID,
			AttrTypeCode,
			LanguageID,
			ModelID,
			PlainText,
			HtmlText,
			LovCode,
			ItemTypeCode,
			ClassCode,
			Deleted,
			Font,
			FontFamily,
			FontStyle,
			FontSize,
			FontColor,
			LastUpdated
		) Values(
				#{changeSetID},
				#{seq},
				#{itemID},
				#{attrTypeCode},
				#{languageID},
				#{modelID},
				#{plainText},
				#{htmlText},
				#{lovCode},
				#{itemTypeCode},
				#{classCode},
				#{deleted},
				#{font},
				#{fontFamily},
				#{fontStyle},
				#{fontSize},
				#{fontColor},
				Getdate()
			)
	</insert>
	
	<select id="getMaxAttrRevSeq" resultType="String">
		SELECT ISNULL(MAX(seq)+1, 1) AS Seq FROM XBOLTADM.TB_ITEM_ATTR_REV
	</select> 
	  	
  	<select id="getItemAttrList" resultType="java.util.HashMap" >
  		SELECT Seq,ItemID,AttrTypeCode,LanguageID,ModelID
  			,PlainText,HtmlText,LovCode,ItemTypeCode,ClassCode,Deleted
  			,Font,FontFamily,FontStyle,FontSize,FontColor,LastUpdated
  		FROM XBOLTADM.TB_ITEM_ATTR
  		<where>
	  		<if test="itemID != null and itemID != ''">
				AND ItemID = #{itemID}
			</if>
	  		<if test="changeSetID != null and changeSetID != ''">
				AND ItemID IN (Select ItemID From XBOLTADM.TB_ITEM WHERE CurChangeSet = #{changeSetID}) 
			</if>
			<if test="attrTypeCode != null and attrTypeCode != ''">
				AND AttrTypeCode = #{attrTypeCode}
			</if>
		</where>
  	</select>
  	  	
	<select id="getPjtAuthorInfo" resultType="java.util.HashMap">
		SELECT 
			TP2.AuthorID, 
			TP2.AuthorName, 
			TT.Name
		FROM XBOLTADM.TB_PROJECT TP
		INNER JOIN XBOLTADM.TB_PROJECT TP2 ON TP.RefPjtID = TP2.ProjectID
		INNER JOIN XBOLTADM.TB_MEMBER TM ON TP2.AuthorID = TM.MemberID
		INNER JOIN XBOLTADM.TB_TEAM_TXT TT ON TT.TeamID = TM.TeamID
		WHERE TP.ProjectID = #{projectID} AND TT.LanguageID = #{languageID}
	</select>		
  	
  	<select id="getCSRCount" resultType="String">
 		Select Count(*) AS CSRCount From XBOLTADM.TB_PROJECT TP
 		Where #{authorID} IN (SELECT MemberID FROM XBOLTADM.TB_PJT_MEMBER_REL WHERE ProjectID = TP.ProjectID)
 		<if test="status != null and !status.equals('')">
 			And TP.Status IN (${status})
 		</if>
 		<if test="projectType != null and !projectType.equals('')">
 			And TP.ProjectType = #{projectType}
 		</if>
 	</select>
 	
 	<select id="getDelMarkItemFromModelList" resultType="java.util.HashMap">
 		Select ItemID 
 		From XBOLTADM.TB_ITEM 
 		Where ItemID IN(
			Select ToItemID 
			From XBOLTADM.Tb_Item
			Where FromItemID IN ( Select ItemID From XBOLTADM.tb_Item T1,
													(Select ObjectID 
													From XBOLTADM.TB_ELEMENT 
													Where ModelID = (Select Top 1 ModelID From XBOLTADM.TB_MODEL where MTCategory = 'BAS' And ItemID = #{itemID})
													) T2
								Where T1.ItemID = T2.ObjectID
								And T1.ClassCode = 'CL01005')
								And CategoryCode = 'ST1'
			)
		AND ItemID NOT IN (
						Select ITEMID 
						From XBOLTADM.tb_Item T1,
							(Select ObjectID 
							From XBOLTADM.TB_ELEMENT 
							Where ModelID = (Select Top 1 ModelID From XBOLTADM.TB_MODEL where MTCategory = 'BAS' And ItemID = #{itemID})
							) T2
						Where T1.ItemID = T2.ObjectID
						And T1.ClassCode = 'CL01006'
						)
	
 	</select>
 	 	
 	<update id="updateItemsDelMark"  parameterType="java.util.HashMap">
 		UPDATE XBOLTADM.TB_ITEM SET Deleted = '1' Where ItemID IN (${itemIDs})		
		UPDATE XBOLTADM.TB_ITEM SET Deleted = '1' Where FromItemID IN (${itemIDs}) OR ToItemID IN (${itemIDs}) 				
 	</update>
 	
 	
 	<select id="getCsrListWithMember" resultType="java.util.HashMap">
		SELECT distinct 
			T1.ProjectID As CODE
			, (T4.Name + '/' +T3.Name) AS NAME
			, T1.Status
  		FROM XBOLTADM.TB_PROJECT T1
	  		Left Outer Join XBOLTADM.TB_PJT_MEMBER_REL T2
	  			on T1.ProjectID = T2.ProjectID
	  		Left Outer Join XBOLTADM.TB_PROJECT_TXT T3
			  	on T1.ProjectID = T3.ProjectID AND T3.LanguageID = #{languageID}
			Left Outer Join XBOLTADM.TB_PROJECT_TXT T4
			  	on T1.RefPjtID = T4.ProjectID AND T4.LanguageID = #{languageID}
  		WHERE 
  			T1.ProjectType = 'CSR'
  			AND T1.Status IN ('CSR', 'CNG')
  			AND (T1.Creator = #{AuthorID} OR T2.MemberID = #{AuthorID})
  		ORDER BY NAME
	</select>
	
	<select id="getAttrRevChangSetInfo" resultType="java.util.HashMap">
		Select T2.RNUM AS RNUM
			, T2.RNUM+1 As PreRNUM
			, T2.RNUM-1 AS NextRNUM
			, T2.ChangeSetID  
		From (
				Select Row_Number()OVER(ORDER BY T1.ChangeSetID DESC ) AS RNUM, T1.ChangeSetID From 
				(
					Select distinct ChangeSetID, itemId  
					from XBOLTADM.TB_ITEM_ATTR_REV
					Where ItemID = #{itemID} and LanguageID = #{languageID}
				) T1
			) T2
		<where>
			<if test="changeSetID != null and !changeSetID.equals('')">
				T2.ChangeSetID = #{changeSetID}
			</if>
			<if test="rNum != null and !rNum.equals('')">
				T2.RNUM = #{rNum}
			</if>
		</where>	
	</select>
	
	<select id="getAttrRevChangSetID" resultType="String">
		Select 
			T2.ChangeSetID AS ChangeSetID
		From (
				Select Row_Number()OVER(ORDER BY T1.ChangeSetID DESC ) AS RNUM, T1.ChangeSetID From 
				(
					Select distinct ChangeSetID, itemId  
					from XBOLTADM.TB_ITEM_ATTR_REV
					Where ItemID = #{itemID} and LanguageID = #{languageID}
				) T1
			) T2
		Where T2.RNUM = #{rNum}
	</select>
	
 	<select id="getMemberProjectList" resultType="java.util.HashMap">
 		SELECT
			PTR.ProjectID, PXT.Name as ProjectName, TP.Deactivated, TP.ProjectCode
		FROM
			XBOLTADM.TB_PROJECT TP 
			Left Outer Join XBOLTADM.TB_PJT_MEMBER_REL PTR ON TP.ProjectID = PTR.ProjectID
			Left Outer Join XBOLTADM.TB_PROJECT_TXT PXT on PTR.ProjectID = PXT.ProjectID
		WHERE
			PTR.MemberID = #{sessionUserId}
			AND PXT.LanguageID = #{sessionCurrLangType}
			AND TP.Status = 'OPN'
			AND TP.PJCategory = 'VAR'
		Order by 
			ProjectID ASC
 	</select>
 	
 	<select id="getMemberProjectText" resultType="String">
 		SELECT
			TP.ProjectCode + ' ' + PXT.Name as ProjectName
		FROM
			XBOLTADM.TB_PROJECT TP 
			Left Outer Join XBOLTADM.TB_PJT_MEMBER_REL PTR ON TP.ProjectID = PTR.ProjectID
			Left Outer Join XBOLTADM.TB_PROJECT_TXT PXT on PTR.ProjectID = PXT.ProjectID
		WHERE
			TP.ProjectID = #{projectID}
			AND PTR.MemberID = #{sessionUserId}
			AND PXT.LanguageID = #{sessionCurrLangType}
			AND TP.Status = 'OPN'
			AND TP.PJCategory = 'VAR'
 	</select>
 	
 	<select id="getProjectPath" resultType="String">
 		SELECT XBOLTADM.fn_getMyAbsPathForProject(#{projectID}, #{languageID}) AS Path
 	</select>
 	
 	<select id="getProjectMemberRelCnt" resultType="String">
 		Select Count(ProjectID) from XBOLTADM.TB_PJT_MEMBER_REL where MemberID = #{sessionUserId}
 	</select>
 	
 	<select id="getUserListTypeString" resultType="String">
 		SELECT
			STUFF((
			  SELECT ',' + CAST(EmployeeNum AS VARCHAR(10))
			  FROM (
				 SELECT EmployeeNum
				 FROM XBOLTADM.TB_MEMBER
				 WHERE MLVL != 'SYS' AND LoginID not in('GUEST')
			  )A
			  FOR XML PATH('')
			 ),1,1,'') AS userList
 	</select>
 	
	<update id="updateItemProjectForCS" parameterType="java.util.HashMap">
		 Update XBOLTADM.TB_ITEM 
		    Set ProjectID = #{ProjectID}		      
		 Where CurChangeSet = #{ChangeSetID}
	</update>
	
	<select id="getCheckInOption" resultType="String">
 	SELECT ISNULL(PJT.CheckInOption, ICL.CheckInOption)
 		  FROM XBOLTADM.TB_Project PJT, XBOLTADM.TB_Item_Class ICL
 		 WHERE ICL.ItemClassCode = #{itemClassCode} AND PJT.ProjectID = #{projectID} 
 	</select>
 	
	<select id="getCurChangeSetIDFromItem" resultType="String" >
		Select CurChangeSet From XBOLTADM.TB_Item
		Where ItemID = #{itemID} 
	</select> 
	
	<select id="getItemClassDefVersion" resultType="String">
 		SELECT ISNULL(DefVersionIncr,0.1) AS DefVersionIncr
 		  FROM XBOLTADM.TB_ITEM_CLASS
 		 WHERE ItemClassCode = #{itemClassCode}
 	</select>
 	
 	<select id="getProjectIDForCRM" resultType="String">
  		Select ProjectID From XBOLTADM.TB_PROJECT Where CompanyID = #{companyID}
	</select>
 	
 	
	<delete id="changeSetFile_delete" parameterType="java.util.HashMap">
		DELETE XBOLTADM.TB_FILE	
		 where Seq = #{seq}		 
		   <if test="changeSetID != null and changeSetID != ''">
		    OR ChangeSetID = #{changeSetID}
		  </if>			 
	</delete>
	
 	
 	<select id="getSRIDByProjectID" resultType="String">
 		Select SRID
 		  From XBOLTADM.TB_PROJECT 
	 	Where ProjectID = #{projectID}
	</select>
	
	
	<select id="getMaxProjectCode" resultType="String">
  		SELECT
      		TOP 1 ProjectCode
  		FROM XBOLTADM.TB_PROJECT
  		Where RefPGID = #{refID} AND ProjectType = #{pType} AND subString(ProjectCode,LEN(#{pgCode})+1,2) = #{thisYY}
  		order by ProjectID DESC
	</select>
	
	
	<select id="getPjtAuthorCnt" resultType="String">
  		SELECT
      			COUNT(*) AS pjtAuthorCnt
  		FROM XBOLTADM.TB_PROJECT
  		Where AuthorID = #{authorID}
  		 <if test="projectID != null and projectID != ''">
		    And ProjectID = #{projectID}
		  </if>			 
	</select>
	
	
	<select id="getMyCsrList" resultType="java.util.HashMap">
  		SELECT TP.ProjectID As CODE
      		 , TPT.Name As NAME
      		 , TP.Status
      		 , TP.ProjectCode As PCODE
      		 , TM.Name AS MemName
			 , CONVERT(varchar(14),TP.CreationTime,111) as CreationTime
			 , TP.ProjectType
			 , TPPT.Name AS ParentName
			 , CONVERT(varchar(14),TP.DueDate,111) as DueDate
			 , ISNULL(TD.Name,'') AS StatusName
  		FROM XBOLTADM.TB_PROJECT TP
  		Left Outer Join XBOLTADM.TB_PROJECT_TXT TPT
				on TP.ProjectID = TPT.ProjectID AND TPT.LanguageID = #{languageID}
		Left Outer Join XBOLTADM.TB_PROJECT TPP 
		        on TP.ParentID = TPP.ProjectID
  		Left Outer Join XBOLTADM.TB_PROJECT_TXT TPPT
				on TPP.ProjectID = TPPT.ProjectID AND TPPT.LanguageID = #{languageID}
  		Left Outer Join XBOLTADM.TB_MEMBER TM
				on TP.AuthorID = TM.MemberID
		Left Outer Join XBOLTADM.TB_DICTIONARY TD
		        on TP.Status = TD.TypeCode AND TD.Category = 'CSRSTS' AND TD.LanguageID = #{languageID}
  		WHERE RTRIM(TP.ProjectType) = #{ProjectType}
  		    AND TP.Deactivated != 1
			<if test="ParentID != null and ParentID != ''">
				AND TP.RefPjtID = #{ParentID}	
			</if>
			<if test="ProjectID != null and ProjectID != ''">
				AND TP.ProjectID = #{projectID}	
			</if>
			<if test="Creator != null and Creator != ''">
				AND TP.Creator = #{Creator}
			</if>
			<choose>
				<when test="'ING'.equals(csrStatus)">
					AND TP.Status NOT IN ('CLS','WTR')
				</when>
				<when test="'COMPL'.equals(csrStatus)">
					AND TP.Status IN ('CLS','WTR')				
				</when>
				<otherwise>
					AND TP.Status = #{Status} 
				</otherwise>
			</choose>
			<if test="Status != null and Status != ''">
				AND TP.Status = #{Status} 
			</if>
			<if test="RefPGID != null and RefPGID != ''">
				AND TP.RefPGID = #{RefPGID}
			</if>
			<if test="AuthorID != null and AuthorID != ''">
				AND TP.AuthorID = #{AuthorID}
			</if>
			<if test="RefPjtID != null and RefPjtID != ''">
				AND TP.RefPjtID = #{RefPjtID}
			</if>
			<if test="memberId != null and memberId != ''">
				AND TP.ProjectID in (Select ProjectID from XBOLTADM.TB_PJT_MEMBER_REL where MemberID = #{memberId})
			</if>
			<if test="workerID != null and workerID != ''">
			AND (ISNULL(TP.AuthorID,'') = #{workerID} OR #{workerID} in (SELECT MemberID FROM XBOLTADM.TB_PJT_MEMBER_REL WHERE ProjectID = TP.ProjectID))
			</if>
		ORDER BY TP.ProjectCode DESC
	</select>
	
	<select id="getRefPGID" resultType="String">
  		SELECT RefPGID FROM XBOLTADM.TB_PROJECT Where ProjectID = #{projectID}
	</select>
	
	<select id="getPjtMbrRelCnt" resultType="String">
  		SELECT
      			COUNT(*) 
  		FROM XBOLTADM.TB_PJT_MEMBER_REL
  		Where ProjectID = #{projectID}
		And MemberID = #{userID}	 
	</select>
	
	<select id="getProjectItemAccCtrl" resultType="String" >
	  	Select ISNULL(ItemAccCtrl,'0') AS ItemAccCtrl
	 	From XBOLTADM.TB_PROJECT
	 	Where ProjectID = #{projectID} 
	 </select>
	
	<update id="updatePjtTeamRel" parameterType="java.util.HashMap">
 		UPDATE 
 			XBOLTADM.TB_PJT_TEAM_REL
		SET
			<if test="status != null and status != ''">
				Status = #{status},
			</if>
			<if test="memo != null and memo != ''">
				Memo = #{memo},
			</if>
			<if test="changeLog != null">
				ChangeLog = #{changeLog},
			</if>
			LastUpdated = GETDATE()
		WHERE
			TeamID = #{teamID}
			And ProjectID = #{projectID}
 	</update>
</mapper>